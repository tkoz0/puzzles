function Fobidoshi(){var c=this;c.constructor();var e=c.board.c,m=0,n=0,k=0,l=0;c.uis.puzzle=["Fobidoshi (Forbidden Four)","Fobidoshi (Verbotene Vier)"];var q=[1,0,-1,0],r=[0,1,0,-1];c.charToValue=c.charToValue.concat(["a",1,"s",0,"d",nil,".",1,",",0,"-",nil,"o",1,"x",0,"/",nil]);c.cell.values=[1,0,nil];c.enable.dragging=!0;c.keypad.left=nil;c.cell.nilalias=0;c.init=function(){Object.getPrototypeOf(c).init.call(c)};c.reset2=function(){try{m=c.labels.west;n=c.labels.north;k=c.size.x-c.labels.east;
l=c.size.y-c.labels.south;c.enable.pgrid=!0;if(c.level.problem){var a=0;var b=c.level.problem.replace(/\s+/g," ").trim().split(" ");for(var d=n;d<l;d++)for(var f=m;f<k;f++){var g=e[f][d];var h=b[a++];"."==h||"-"==h?g.value=nil:"x"==h||"#"==h?g.value=0:"o"==h?g.value=1:"@"==h&&(g.areas=c.cell.outside,g.fixed=!0,g.valid=!1,c.enable.pgrid=!1);g.value!=nil&&(g.fixed=!0)}}if(c.level.solution)for(a=0,b=c.level.solution.replace(/\s+/g," ").trim().split(" "),d=n;d<l;d++)for(f=m;f<k;f++)if(g=e[f][d],h=b[a++],
"-"==h||"."==h)g.solution=nil;else if("x"==h||"o"==h)g.solution=1}catch(p){throw c.exception(p),p;}};c.check2=function(){try{for(var a=n;a<l;a++){var b=0;for(var d=m;d<k;d++)if(1!=e[d][a].value)b=0;else if(3<++b)for(var f=0;4>f;f++)e[d-f][a].error=1}for(d=m;d<k;d++)for(b=0,a=n;a<l;a++)if(1!=e[d][a].value)b=0;else if(3<++b)for(f=0;4>f;f++)e[d][a-f].error=1;b=1;for(d=m;d<k;d++)for(a=n;a<l;a++){var g=e[d][a];1==g.value&&0==g.count&&c.markArea(g,b++)}2!=b&&(c.solved=!1)}catch(h){throw c.exception(h),
h;}};c.markArea=function(a,b){try{a.count=b;for(var d=0;4>d;d++){var f=a.x+q[d],g=a.y+r[d];if(0<=f&&f<k&&0<=g&&g<l){var h=e[f][g];1==h.value&&0==h.count&&c.markArea(h,b)}}}catch(p){throw c.exception(p),p;}};c.solve2=function(){try{for(var a=m;a<k;a++)for(var b=n;b<l;b++){var d=e[a][b];1==d.value&&b<l-1&&1==e[a][b+1].value&&(b<l-2&&1==e[a][b+2].value&&(b<l-3&&e[a][b+3].value==nil&&(e[a][b+3].value=0),0<b&&e[a][b-1].value==nil&&(e[a][b-1].value=0)),b<l-3&&e[a][b+2].value==nil&&1==e[a][b+3].value&&(e[a][b+
2].value=0),1<b&&e[a][b-1].value==nil&&1==e[a][b-2].value&&(e[a][b-1].value=0))}for(b=n;b<l;b++)for(a=m;a<k;a++)d=e[a][b],1==d.value&&a<k-1&&1==e[a+1][b].value&&(a<k-2&&1==e[a+2][b].value&&(a<k-3&&e[a+3][b].value==nil&&(e[a+3][b].value=0),0<a&&e[a-1][b].value==nil&&(e[a-1][b].value=0)),a<k-3&&e[a+2][b].value==nil&&1==e[a+3][b].value&&(e[a+2][b].value=0),1<a&&e[a-1][b].value==nil&&1==e[a-2][b].value&&(e[a-1][b].value=0))}catch(f){throw c.exception(f),f;}};c.valueToString=function(a,b){return 1==a?
"o":0==a?b?"x":"-":"-"};c.paintCell=function(a){try{var b=c.canvas.getContext("2d");b.fillStyle=0==a.value&&a.fixed?c.uic.dark[0]:c.uic.light[0];b.fillRect(a.px,a.py,c.unit.x,c.unit.y);b={};b.fill=!c.solved&&c.display.errors?c.uic.light[(a.count-1)%10]:c.uic.light[a.color];b.color=a.error&&c.display.errors?b.stroke=c.uic.error:a.fixed?b.stroke=c.uic.clue:b.stroke=c.uic.text;1==a.value?c.paintCircle(a,b):0!=a.value||a.fixed||c.paintCross(a,b);c.paintSymbolMarkers(a)}catch(d){throw c.exception(d),d;
}};c.paintCurrentValue=function(){try{var a=c.uie.value,b=a.getContext("2d");b.fillStyle=c.uic.white;b.fillRect(0,0,a.width,a.height);1==c.current.value?c.paintCircle(b,{x:0,y:0,w:a.width,h:a.height,fill:c.uic.white,stroke:c.uic.black}):0==c.current.value&&c.paintCross(b,{x:0,y:0,w:a.width,h:a.height,width:2,color:c.uic.black})}catch(d){throw c.exception(d),d;}}}Fobidoshi.prototype=new Puzzle;
