function Japsums(){var a=this;a.constructor();a.uis.puzzle=["Japanese Sums","Japanische Summen"];var g=a.board.c,l=0,n=0;a.charToValue=a.charToValue.concat(["0",0,"x",0,"-",nil,"/",nil,"o",-2]);a.enable.vmarkers=!0;a.enable.pgrid=!0;a.enable.values=!1;a.enable.currentValue=!1;a.init=function(){Object.getPrototypeOf(a).init.call(a)};a.setup2=function(){var b;try{l=a.size.x;n=a.size.y;if(!a.level.rlabels&&!a.level.clabels&&a.level.solution){for(var f=Array(l),c=0;c<l;c++)f[c]=Array(n);var d=0;for(var h=
a.level.solution.replace(/\s+/g," ").trim().split(" "),e=0;e<n;e++)for(c=0;c<l;c++){var g=h[d];f[c][e]="-"==g||"."==g||"x"==g?0:parseInt(g);d++}h="";for(e=0;e<n;e++){var k="";for(c=b=0;c<l;c++)0!=f[c][e]?b+=f[c][e]:0!=b&&(k+=b+" ",b=0);0!=b&&(k+=b+" ");0==k.length&&(k="0");h+=k+"\n"}a.level.rlabels=h;h="";for(c=0;c<l;c++){k="";for(e=b=0;e<n;e++)0!=f[c][e]?b+=f[c][e]:0!=b&&(k+=b+" ",b=0);0!=b&&(k+=b+" ");0==k.length&&(k="0");h+=k+"\n"}a.level.clabels=h}a.labels.north=1;var m=a.level.clabels.trim().split("\n");
for(d=0;d<m.length;d++){var q=m[d].replace(/\s+/g," ").trim().split(" ");q.length>a.labels.north&&(a.labels.north=q.length)}n+=a.labels.north;a.labels.west=1;m=a.level.rlabels.trim().split("\n");for(d=0;d<m.length;d++)q=m[d].replace(/\s+/g," ").trim().split(" "),q.length>a.labels.west&&(a.labels.west=q.length);l+=a.labels.west}catch(r){throw a.exception(r),r;}};a.reset2=function(){var b;try{l=a.size.x-a.labels.east;n=a.size.y-a.labels.south;a.cell.min=1;a.cell.max=a.size.z;a.cell.values=[];var f=
0;for(b=1;b<=a.size.z;b++)a.cell.values[f++]=b;a.cell.values[f++]=0;a.cell.values[f++]=-2;a.cell.values[f++]=nil;a.valueToMarker=[0,a.marker.letterX];for(b=1;b<=a.size.z;b++)a.valueToMarker[2*b]=b,a.valueToMarker[2*b+1]=a.marker.numberBase+b;f=a.size.z;a.keypadValues=a.keypad.numbers.slice(0,f);a.keypadValues[f++]=["O",-2];a.keypadValues[f++]=["\u00d7",0,a.uic.dark];a.keypadValues[f++]=["\u2022",nil];a.infoText=a.uis.get("numbers")+": 1~"+a.size.z;var c=a.level.clabels.trim().split("\n");f=0;for(var d=
a.labels.west;d<l;d++){var h=c[f++].replace(/\s+/g," ").trim().split(" ");b=a.labels.north-h.length;for(var e=0;e<a.labels.north;e++)g[d][e+b].label=h[e]}c=a.level.rlabels.trim().split("\n");f=0;for(e=a.labels.north;e<n;e++)for(h=c[f++].replace(/\s+/g," ").trim().split(" "),b=a.labels.west-h.length,d=0;d<a.labels.west;d++)g[d+b][e].label=h[d];if(a.level.problem){b=0;var p=a.level.problem.replace(/\s+/g," ").trim().split(" ");for(e=a.labels.north;e<n;e++)for(d=a.labels.west;d<l;d++){var k=g[d][e];
var m=p[b++];"."==m||"-"==m?k.value=nil:(k.value="x"==m?0:parseInt(m),k.fixed=!0)}}if(a.level.solution)for(b=0,p=a.level.solution.replace(/\s+/g," ").trim().split(" "),e=a.labels.north;e<n;e++)for(d=a.labels.west;d<l;d++)k=g[d][e],m=p[b++],k.solution="."==m||"-"==m||"x"==m?0:parseInt(m);a.reset2labels()}catch(q){throw a.exception(q),q;}};a.check2=function(){try{for(var b=a.labels.north;b<n;b++){var f=[];for(var c=a.labels.west;c<l;c++){var d=g[c][b];d.value==nil?d.error=1:0!=d.value&&(void 0===f[d.value]?
f[d.value]=c:(d.error=5,g[f[d.value]][b].error=5))}}for(c=a.labels.west;c<l;c++)for(f=[],b=a.labels.north;b<n;b++)d=g[c][b],d.value==nil?d.error=1:0!=d.value&&(void 0===f[d.value]?f[d.value]=b:(d.error=5,g[c][f[d.value]].error=5));for(b=a.labels.north;b<n;b++){var h;for(h=0;h<a.labels.west&&g[h][b].label==nil;h++);var e=0;for(c=a.labels.west;c<l;c++)0<g[c][b].value?e+=g[c][b].value:0!=e&&(g[h][b].label!=e&&(g[h][b].error=3),e=0,h++);h!=a.labels.west&&g[h][b].label!=e&&(g[h][b].error=3)}for(c=a.labels.west;c<
l;c++){var p;for(p=0;p<a.labels.north&&g[c][p].label==nil;p++);e=0;for(b=a.labels.north;b<n;b++)0<g[c][b].value?e+=g[c][b].value:0!=e&&(g[c][p].label!=e&&(g[c][p].error=3),e=0,p++);p!=a.labels.north&&g[c][p].label!=e&&(g[c][p].error=3)}}catch(k){throw a.exception(k),k;}};a.valueToString=function(a,f){try{return a==nil?"-":0==a?"x":-2==a?"o":a.toString()}catch(c){return ojdebug(c.toString()),"%"}};a.paintCell=function(b){try{b.areas==a.cell.label?a.paintLabelCell(b):a.paintValueCell(b)}catch(f){throw a.exception(f),
f;}};a.paintLabelCell=function(b){try{var f=a.canvas.getContext("2d");f.fillStyle=a.uic.label;f.fillRect(b.px,b.py,a.unit.x,a.unit.y);b.label!=nil&&a.paintText(b.label,b);b.error&&a.display.errors&&a.paintErrorCircle(b)}catch(c){throw a.exception(c),c;}};a.paintValueCell=function(b){try{var f=a.canvas.getContext("2d");f.fillStyle=0==b.value?a.uic.dark[b.color]:a.uic.light[b.color];f.fillRect(b.px,b.py,a.unit.x,a.unit.y);a.paintSymbolMarkers(b);a.paintValueMarkers(b);-2==b.value?a.paintCircle(b,{color:b.fixed?
a.uic.clue:a.uic.text}):0<b.value&&a.paintText(b.value.toString(),b,{color:b.fixed?a.uic.clue:a.uic.text});b.error&&a.display.errors&&(b.value==nil?a.paintErrorDot(b):a.paintErrorCircle(b))}catch(c){throw a.exception(c),c;}}}Japsums.prototype=new Puzzle;
