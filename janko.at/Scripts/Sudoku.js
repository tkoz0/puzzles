function Sudoku(){var a=this;a.constructor();a.uis.puzzle=["Sudoku"];var k=a.board.c,v=0,w=0,q=0,p=0;a.variant.sudoku=["sudoku",["Sudoku"]];a.variant.kropki=["kropki",["Sudoku (Kropki)"]];a.variant.mega=["mega",["Sudoku (Mega)"]];a.variant.cs=["cs",["Sudoku (Consecutive)","Sudoku (Konsekutiv)"]];a.variant.gt=["gt",["Sudoku (Greater-Than","Vergleichssudoku"]];a.variant.fs=["fs",["Sudoku (Frame)"]];a.variant.ls=["ls",["Sudoku (Chaos)"]];a.variant.mn=["mn",["Sudoku (Magic)"]];a.variant.ms=["ms",["Sudoku (2D)"]];
a.variant.oe=["oe",["Sudoku (Odd-Even)","Sudoku (Gerade-Ungerade)"]];a.variant.pm=["pm",["Sudoku (Fencilmarks)","Kandidaten-Sudoku"]];var t=[0],u=[0];a.uic.shade1="#e0e0e0";a.uic.shade2="#d0d0d0";a.uic.shade3="#c0c0c0";a.uic.shade4="#b0b0b0";a.uic.gtlt="#000000";a.uic.markers="#888888";a.uic.nodefill="#ffffff";a.uic.nodeedge=a.uic.none;a.uic.nodetext="#883333";a.uic.markedge="#aaaaaa";a.uic.markfill="#dddddd";a.uic.path="#bbbbbb";a.uis.magic=["Magic Number","Magische Zahl"];a.keys=a.keys.concat("pattern patternx patterny cornerx cornery display magic".split(" "));
var n={none:0,empty:1,duplicate:2,oe:3,cs:4,mn:5,gt:6,fs:7,kropki:8};a.charToValue=a.charToValue.concat(["x",nil,"/",nil,",",nil,"-",nil]);a.enable.vmarkers=!0;a.enable.values=!1;a.enable.currentValue=!1;a.init=function(){Object.getPrototypeOf(a).init.call(a)};a.setup2=function(){try{!a.level.puzzle&&a.level.variant&&(a.level.puzzle=a.level.variant);"odd-even"==a.level.variant&&(a.level.variant="oe");a.variant.init(a.variant.sudoku);a.level.layout||(a.level.layout="single");a.level.pattern||(a.level.pattern=
"0");a.level.patternx||(a.level.patternx=a.level.pattern);a.level.patterny||(a.level.patterny=a.level.pattern);a.level.cornerx=a.level.cornery="0";a.labels.north=a.labels.south=a.labels.east=a.labels.west=0;if(a.level.nlabels){var b=a.level.nlabels.replace(/\s+/g," ").trim().split(" ");a.labels.west=parseInt(b[0]);a.labels.north=parseInt(b[1]);a.labels.east=parseInt(b[2]);a.labels.south=parseInt(b[3])}a.variant.is(a.variant.mega)?(a.level.cols=a.level.rows=a.level.depth="16",a.level.patternx=a.level.patterny=
4):a.variant.is(a.variant.fs)?(a.uis.puzzle=["Frame Sudoku","Randsummen-Sudoku"],a.labels.north=a.labels.south=a.labels.east=a.labels.west=1):a.variant.is(a.variant.gt)?a.uis.puzzle=["Greater-Than Sudoku","Vergleichs-Sudoku"]:a.variant.is(a.variant.oe)?a.uis.puzzle=["Odd-Even Sudoku","Gerade-Ungerade Sudoku"]:a.variant.is(a.variant.cs)&&(a.uis.puzzle=["Concective-Sudoku","Konsekutiv-Sudoku"]);if(a.variant.is(a.variant.sudoku)||a.variant.is(a.variant.fs)||a.variant.is(a.variant.gt)||a.variant.is(a.variant.oe))"0"==
a.level.patternx&&(a.level.patternx="3"),"0"==a.level.patterny&&(a.level.patterny="3");if("double"==a.level.layout)a.level.cols=a.level.rows="12",a.level.depth="9",a.level.cornerx=a.level.cornery=[0,3];else if("double"==a.level.layout)a.level.cols=a.level.rows="15",a.level.depth="9",a.level.cornerx=a.level.cornery="0 6";else if("gattai-3"==a.level.layout)a.level.cols=a.level.rows="15",a.level.depth="9",a.level.cornerx="3 6 0",a.level.cornery="0 3 6";else if("gattai-8"==a.level.layout)a.level.cols=
"33",a.level.rows="21",a.level.depth="9",a.level.cornerx="0 12 24  6 18  0 12 24",a.level.cornery="0  0  0  6  6 12 12 12";else if("samurai"==a.level.layout)a.level.cols=a.level.rows="21",a.level.depth="9",a.level.cornerx="0  0 12 12 6",a.level.cornery="0 12  0 12 6";else if("gattai-8"==a.level.layout)a.level.cols="33",a.level.rows="21",a.level.depth="9",a.level.cornerx="0 12 24  6 18  0 12 24",a.level.cornery="0  0  0  6  6 12 12 12";else if("shogun"==a.level.layout)a.level.cols="45",a.level.rows=
"21",a.level.depth="9",a.level.cornerx="0 12 24 36 6 18 30  0 12 24 36",a.level.cornery="0  0  0  0 6  6  6 12 12 12 12";else if("wing-3"==a.level.layout)a.level.cols="21",a.level.rows="15",a.level.depth="9",a.level.cornerx="0 12 6",a.level.cornery="0  9 6";else if("wing-5"==a.level.layout)a.level.cols="27",a.level.rows="21",a.level.depth="9",a.level.cornerx="0 18 3 15  9",a.level.cornery="0  0 6  6 12";else if("butterfly"==a.level.layout)a.level.cols=a.level.rows="12",a.level.depth="9",a.level.cornerx=
"0 3 0 3",a.level.cornery="0 0 3 3";else if("sohei"==a.level.layout)a.level.cols=a.level.rows="21",a.level.depth="9",a.level.cornerx="6 0 12  6",a.level.cornery="0 6  6 12";else if("flower"==a.level.layout)a.level.cols=a.level.rows="15",a.level.depth="9",a.level.cornerx="3 0 3 6 3",a.level.cornery="0 3 3 3 6";else if("windmill"==a.level.layout)a.level.cols=a.level.rows="21",a.level.depth="9",a.level.cornerx="3 12 6 0 9",a.level.cornery="0 3 6 9 12";else if("sumo"==a.level.layout)a.level.cols=a.level.rows=
"33",a.level.depth="9",a.level.cornerx="0 12 24 6 18  0 12 24  6 18, 0 12 24",a.level.cornery="0  0  0 6  6 12 12 12 18 18 24 24 24";else if("clueless-1"==a.level.layout||"clueless-2"==a.level.layout)a.level.cols=a.level.rows="27",a.level.depth="9",a.level.cornerx="0 0  0 9 9  9 18 18 18",a.level.cornery="0 9 18 0 9 18  0  9 18";a.labels.west&&(a.level.cornerx=a.labels.west.toString());a.labels.north&&(a.level.cornery=a.labels.north.toString());a.level.size||(a.level.size="9");a.level.rows||(a.level.rows=
a.level.size);a.level.cols||(a.level.cols=a.level.size);a.level.depth||(a.level.depth=a.level.size)}catch(f){throw a.exception(f),f;}};a.reset2=function(){var b;try{v=a.labels.west;q=a.size.x-a.labels.east;w=a.labels.north;p=a.size.y-a.labels.south;a.cell.min=1;a.cell.max=a.size.z;a.cell.values=[];var f=0;for(b=1;b<=a.size.z;b++)a.cell.values[f++]=b.toString();a.cell.values[f++]=nil;f=0;a.keypadValues=[];for(b=1;b<=a.size.z;b++)a.keypadValues[f++]=[b.toString(),b];a.keypadValues[f++]=["\u2022",nil];
a.level.areas&&a.reset2areas(v,w,q,p,a.level.areas);if(a.level.problem){b=0;var e=a.level.problem.replace(/\s+/g," ").trim().split(" ");for(var d=w;d<p;d++)for(var c=v;c<q;c++){var g=k[c][d];var h=e[b++];"."==h||"-"==h?g.value=nil:a.variant.is(a.variant.oe)&&"e"==h?(g.clues=2,g.value=nil):a.variant.is(a.variant.oe)&&"o"==h?(g.clues=1,g.value=nil):("a"<=h&&"z">=h?g.value=h.charCodeAt(0)-96:"A"<=h&&"Z">=h?g.value=h.charCodeAt(0)-64:(h.contains("*")&&(g.clues=4,h=h.replace("*","")),0!=h.length&&(g.value=
parseInt(h))),g.fixed=!0)}}if(a.level.solution)for(b=0,e=a.level.solution.replace(/\s+/g," ").trim().split(" "),d=w;d<p;d++)for(c=v;c<q;c++)g=k[c][d],h=e[b++],g.solution="."==h||"-"==h?nil:"a"<=h&&"z">=h?h.charCodeAt(0)-96:"A"<=h&&"Z">=h?h.charCodeAt(0)-64:parseInt(h);if(a.level.clues)for(b=0,e=a.level.clues.replace(/\s+/g," ").trim().split(" "),d=w;d<p;d++)for(c=v;c<q;c++)g=k[c][d],h=e[b++],g.clues="."==h||"-"==h?0:parseInt(h);if(a.level.celltext)for(b=0,e=a.level.celltext.replace(/\s+/g," ").replace(/&gt;/gi,
">").replace(/&lt;/gi,"<").trim().split(" "),d=0;d<a.size.y;d++)for(c=0;c<a.size.x;c++)g=k[c][d],h=e[b++],g.text="."==h||"-"==h?"":h;if(a.level.nodetext)for(a.enable.pnodes=!0,b=0,e=a.level.nodetext.replace(/\s+/g," ").replace(/&gt;/gi,">").replace(/&lt;/gi,"<").trim().split(" "),d=0;d<=a.size.y;d++)for(c=0;c<=a.size.x;c++){var m=a.board.n[c][d];h=e[b++];m.text="."==h||"-"==h?"":h}else a.enable.pnodes=!1;if(a.level.linetext)for(b=0,e=a.level.linetext.replace(/\s+/g," ").replace(/&gt;/gi,">").replace(/&lt;/gi,
"<").trim().split(" "),d=0;d<a.size.y;d++)for(c=0;c<a.size.x;c++)if(h=e[b++],"."==h||"-"==h)a.board.h[c][d+1].text="",a.board.v[c+1][d].text="";else{m=f="";var l=h.indexOf("|");-1==l?f=h:(f=h.substring(0,l),m=h.substring(l+1));a.board.v[c+1][d].text=f;a.board.h[c][d+1].text=m}if(a.level.cellmarkers)for(b=0,e=a.level.cellmarkers.replace(/\s+/g," ").trim().split(" "),d=0;d<a.size.y;d++)for(c=0;c<a.size.x;c++)g=k[c][d],h=e[b++],h.contains("r")&&(g.flags|=1,h=h.replace("r","")),h.contains("g")&&(g.flags|=
2,h=h.replace("g","")),h.contains("b")&&(g.flags|=3,h=h.replace("b","")),h.contains("y")&&(g.flags|=16,h=h.replace("y","")),h.contains("c")&&(g.flags|=32,h=h.replace("c","")),h.contains("s")&&(g.flags|=64,h=h.replace("s","")),h.contains("d")&&(g.flags|=128,h=h.replace("d","")),0!=h.length&&(g.flags|=parseInt(h));if(a.level.cellpath)for(b=0,e=a.level.cellpath.replace(/\s+/g," ").trim().split(" "),d=0;d<a.size.y;d++)for(c=0;c<a.size.x;c++)g=k[c][d],g.pathnum=nil,g.pathinfo=nil,h=e[b++],h.contains("c")&&
(g.pathinfo=1,h=h.replace("c","")),h.contains("o")&&(g.pathinfo=1,h=h.replace("o","")),h.contains("q")&&(g.pathinfo=2,h=h.replace("q","")),h.contains("a")&&(g.pathinfo=4,h=h.replace("a","")),0!=h.length&&(g.pathnum=parseInt(h));if(a.level.clabels){b=0;e=a.level.clabels.replace(/\s+/g," ").trim().split(" ");for(d=0;d<a.labels.north;d++)for(c=v;c<q;c++)g=k[c][d],h=e[b++],g.label="-"==h||"."==h?nil:parseInt(h);for(d=a.size.y-a.labels.south;d<a.size.y;d++)for(c=v;c<q;c++)g=k[c][d],h=e[b++],g.label="-"==
h||"."==h?nil:parseInt(h)}if(a.level.rlabels){b=0;e=a.level.rlabels.replace(/\s+/g," ").trim().split(" ");for(c=0;c<a.labels.west;c++)for(d=w;d<p;d++)g=k[c][d],h=e[b++],g.label="-"==h||"."==h?nil:parseInt(h);for(c=a.size.x-a.labels.east;c<a.size.x;c++)for(d=w;d<p;d++)g=k[c][d],h=e[b++],g.label="-"==h||"."==h?nil:parseInt(h)}if(a.level.cornerx){b=0;e=a.level.cornerx.replace(/\s+/g," ").trim().split(" ");t=[];for(b=0;b<e.length;b++)t[b]=parseInt(e[b]);b=0;e=a.level.cornery.replace(/\s+/g," ").trim().split(" ");
u=[];for(b=0;b<e.length;b++)u[b]=parseInt(e[b])}if(!a.level.areas&&0!=a.level.patternx&&0!=a.level.patterny){for(d=0;d<a.size.y;d++)for(c=0;c<a.size.x;c++)k[c][d].areas=a.cell.outside;for(b=0;b<t.length;++b)for(d=0;d<a.size.z;d++)for(c=0;c<a.size.z;c++)g=k[t[b]+c][u[b]+d],g.areas=g.areas==a.cell.outside?t[b]+Math.floor(c/a.level.patternx)+(u[b]+Math.floor(d/a.level.patterny))*a.size.x:g.areas+1E3}for(d=0;d<a.size.y;d++)for(c=0;c<a.size.x;c++)g=k[c][d],g.areas==a.cell.outside&&(g.fixed=!0,g.valid=
!1);a.reset2labels();a.variant.is(a.variant.mn)?a.infoText=a.uis.get("magic")+":"+a.level.magic:a.infoText=a.level.infotext?a.level.infotext:"";if(a.variant.is(a.variant.gt)&&!a.level.clues&&a.level.solution)for(c=0;c<a.size.x;c++)for(d=0;d<a.size.y;d++)g=k[c][d],g.clues=0,c<a.size.x-1&&g.areas==k[c+1][d].areas&&g.solution<k[c+1][d].solution&&(g.clues|=1),d<a.size.y-1&&g.areas==k[c][d+1].areas&&g.solution<k[c][d+1].solution&&(g.clues|=2),0<c&&g.areas==k[c-1][d].areas&&g.solution<k[c-1][d].solution&&
(g.clues|=4),0<d&&g.areas==k[c][d-1].areas&&g.solution<k[c][d-1].solution&&(g.clues|=8);if(a.variant.is(a.variant.oe))for(c=0;c<a.size.x;c++)for(d=0;d<a.size.y;d++)g=k[c][d],g.clues=g.areas==a.cell.outside?nil:0==g.solution%2?2:1;if(a.variant.is(a.variant.cs)&&!a.level.clues&&a.level.solution)for(c=0;c<a.size.x;c++)for(d=0;d<a.size.y;d++)g=k[c][d],g.clues=0,c<a.size.x-1&&1==Math.abs(g.solution-k[c+1][d].solution)&&(g.clues|=1),d<a.size.y-1&&1==Math.abs(g.solution-k[c][d+1].solution)&&(g.clues|=2);
if(a.variant.is(a.variant.kropki)&&!a.level.clues&&a.level.solution)for(c=0;c<a.size.x;c++)for(d=0;d<a.size.y;d++)g=k[c][d],g.clues=0,c<a.size.x-1&&(g.solution==2*k[c+1][d].solution||2*g.solution==k[c+1][d].solution)&&(g.clues|=1),c<a.size.x-1&&(g.solution==k[c+1][d].solution+1||g.solution+1==k[c+1][d].solution)&&(g.clues|=4),d<a.size.y-1&&(g.solution==2*k[c][d+1].solution||2*g.solution==k[c][d+1].solution)&&(g.clues|=2),d<a.size.y-1&&(g.solution==k[c][d+1].solution+1||g.solution+1==k[c][d+1].solution)&&
(g.clues|=8);if(a.variant.is(a.variant.fs)&&!a.level.rlabels&&a.level.solution){for(d=1;d<a.size.y-1;d++)k[0][d].label=k[1][d].solution+k[2][d].solution+k[3][d].solution,k[a.size.x-1][d].label=k[a.size.x-2][d].solution+k[a.size.x-3][d].solution+k[a.size.x-4][d].solution;for(c=1;c<a.size.x-1;c++)k[c][0].label=k[c][1].solution+k[c][2].solution+k[c][3].solution,k[c][a.size.y-1].label=k[c][a.size.y-2].solution+k[c][a.size.y-3].solution+k[c][a.size.y-4].solution}}catch(r){throw a.exception(r),r;}};a.check2=
function(){try{for(var b=0;b<t.length;b++){for(var f=0;f<a.size.z;f++)a.checkLine(t[b]+f,u[b],0,1);for(var e=0;e<a.size.z;e++)a.checkLine(t[b],u[b]+e,1,0);a.level.options.contains("diagonals")&&(a.checkLine(t[b],u[b],1,1),a.checkLine(t[b]+a.size.z-1,u[b],-1,1))}if(k[0][0].areas>nil)for(f=0;f<a.size.x;f++)for(e=0;e<a.size.y;e++){var d=k[f][e];if(!(d.areas<=nil||d.checked))for(var c=[],g=0;g<a.size.x;g++)for(var h=0;h<a.size.y;h++){var m=k[g][h];m.checked||d.areas!=m.areas||(m.checked=!0,m.value==nil?
m.error=n.empty:c[m.value]?m.error=c[m.value].error=n.duplicate:c[m.value]=m)}}if(a.variant.is(a.variant.oe))for(f=0;f<a.size.z;f++)for(e=0;e<a.size.z;e++)d=k[f][e],2==d.clues&&1==d.value%2&&(d.error=n.oe),1==d.clues&&0==d.value%2&&(d.error=n.oe);if(a.variant.is(a.variant.kropki))for(f=0;f<a.size.z;f++)for(e=0;e<a.size.z;e++){d=k[f][e];if(f!=a.size.x-1&&d.value!=nil&&k[f+1][e].value!=nil){var l=k[f+1][e];if(0!=(d.clues&1))d.value!=2*l.value&&2*d.value!=l.value&&(d.error=l.error=n.kropki);else if(0!=
(d.clues&4))d.value!=l.value+1&&d.value+1!=l.value&&(d.error=l.error=n.kropki);else if(d.value==2*l.value||2*d.value==l.value||d.value==l.value+1||d.value+1==l.value)d.error=l.error=n.kropki}if(e!=a.size.y-1&&d.value!=nil&&k[f][e+1].value!=nil)if(l=k[f][e+1],0!=(d.clues&2))d.value!=2*l.value&&2*d.value!=l.value&&(d.error=l.error=n.kropki);else if(0!=(d.clues&8))d.value!=l.value+1&&d.value+1!=l.value&&(d.error=l.error=n.kropki);else if(d.value==2*l.value||2*d.value==l.value||d.value==l.value+1||d.value+
1==l.value)d.error=l.error=n.kropki}if(a.variant.is(a.variant.mn)){var r=parseInt(a.level.magic);for(f=0;f<a.size.z;f++)for(e=0;e<a.size.z;e++)d=k[f][e],f<a.size.x-1&&0!=(d.clues&1)&&(l=k[f+1][e],d.value+l.value!=r&&(d.error=l.error=n.mn)),e<a.size.y-1&&0!=(d.clues&2)&&(l=k[f][e+1],d.value+l.value!=r&&(d.error=l.error=n.mn))}if(a.variant.is(a.variant.cs))for(f=0;f<a.size.z;f++)for(e=0;e<a.size.z;e++)d=k[f][e],0!=(d.clues&1)?f<a.size.x-1&&1!=Math.abs(d.value-k[f+1][e].value)&&(d.error=k[f+1][e].error=
n.cs):f<a.size.x-1&&1==Math.abs(d.value-k[f+1][e].value)&&(d.error=k[f+1][e].error=n.cs),0!=(d.clues&2)?e<a.size.y-1&&1!=Math.abs(d.value-k[f][e+1].value)&&(d.error=k[f][e+1].error=n.cs):e<a.size.y-1&&1==Math.abs(d.value-k[f][e+1].value)&&(d.error=k[f][e+1].error=n.cs);if(a.variant.is(a.variant.fs)){for(e=1;e<a.size.y-1;e++)k[0][e].label!=nil&&k[0][e].label!=k[1][e].value+k[2][e].value+k[3][e].value&&(k[0][e].error=n.fs),k[a.size.x-1][e].label!=nil&&k[a.size.x-1][e].label!=k[a.size.x-2][e].value+
k[a.size.x-3][e].value+k[a.size.x-4][e].value&&(k[a.size.x-1][e].error=n.fs);for(f=1;f<a.size.x-1;f++)k[f][0].label!=nil&&k[f][0].label!=k[f][1].value+k[f][2].value+k[f][3].value&&(k[f][0].error=n.fs),k[f][a.size.y-1].label!=nil&&k[f][a.size.y-1].label!=k[f][a.size.y-2].value+k[f][a.size.y-3].value+k[f][a.size.y-4].value&&(k[f][a.size.y-1].error=n.fs)}if(a.variant.is(a.variant.gt))for(f=0;f<a.size.z;f++)for(e=0;e<a.size.z;e++)d=k[f][e],0!=(d.clues&1)&&(l=k[f+1][e],d.value>l.value&&(d.error=l.error=
n.gt)),0!=(d.clues&2)&&(l=k[f][e+1],d.value>l.value&&(d.error=l.error=n.gt)),0!=(d.clues&4)&&(l=k[f-1][e],d.value>l.value&&(d.error=l.error=n.gt)),0!=(d.clues&8)&&(l=k[f][e-1],d.value>l.value&&(d.error=l.error=n.gt));if("clueless-1"==a.level.layout){for(b=0;b<a.size.z;b++)a.checkLine(3*b+1,1,0,3);for(b=0;b<a.size.z;b++)a.checkLine(1,3*b+1,3,0);for(g=1;27>g;g+=9)for(h=1;27>h;h+=9){var q=0;var p=[];for(f=0;9>f;f+=3)for(e=0;9>e;e+=3)p[q++]=k[g+f][h+e];a.checkSet(p)}}if("clueless-2"==a.level.layout){for(h=
3;27>h;h+=9)for(e=0;3>e;e++){q=0;p=[];for(g=3;27>g;g+=9)for(f=0;3>f;f++)p[q++]=k[g+f][h+e];a.checkSet(p)}for(g=3;27>g;g+=9)for(f=0;3>f;f++){q=0;p=[];for(h=3;27>h;h+=9)for(e=0;3>e;e++)p[q++]=k[g+f][h+e];a.checkSet(p)}}}catch(y){throw a.exception(y),y;}};a.checkLine=function(b,f,e,d){try{for(var c=[],g=0;g<a.size.z;++g){var h=k[b+e*g][f+d*g];h.value==nil?h.error=n.empty:c[h.value]?h.error=c[h.value].error=n.duplicate:c[h.value]=h}}catch(m){throw a.exception(m),m;}};a.checkSet=function(b){try{for(var f=
[],e=0;e<a.size.z;e++){var d=b[e];d.value==nil?d.error=n.empty:f[d.value]?d.error=f[d.value].error=n.duplicate:f[d.value]=d}}catch(c){throw a.exception(c),c;}};a.initValueMarkers2=function(){try{for(var b=0;b<a.size.x;b++)for(var f=0;f<a.size.y;f++)for(var e=1;e<=a.size.z;e++)k[b][f].markers.set(a.marker.numberBase+e)}catch(d){throw a.exception(d),d;}};a.updateValueMarkers2=function(){try{for(var b=0;b<a.size.x;b++)for(var f=0;f<a.size.y;f++){var e=k[b][f];if(e.value!=nil){for(var d=a.marker.numberBase+
e.value,c=0;c<a.size.x;c++)k[c][f].markers.clear(d);for(var g=0;g<a.size.y;g++)k[b][g].markers.clear(d);if(e.areas>nil)for(c=0;c<a.size.x;c++)for(g=0;g<a.size.y;g++){var h=k[c][g];e.areas==h.areas&&h.markers.clear(d)}var m=a.level.options.contains("diagonals");if(m&&b==f)for(var l=0;l<a.size.x;++l)k[l][l].markers.clear(d);if(m&&b==a.size.y-f-1)for(l=0;l<a.size.x;++l)k[l][a.size.y-l-1].markers.clear(d)}}}catch(r){throw a.exception(r),r;}};a.paintCell=function(b){try{b.areas==a.cell.label?a.paintLabelCell(b):
a.paintValueCell(b)}catch(f){throw a.exception(f),f;}};a.paintLabelCell=function(b){try{if(!a.bgimage){var f=a.canvas.getContext("2d");f.fillStyle=a.uic.label;f.fillRect(b.px,b.py,a.unit.x,a.unit.y);if(b.text){var e={scale:50,fill:a.uic.text,stroke:a.uic.text},d={scale:50,fill:a.uic.none,stroke:a.uic.text},c=b.text;c.contains("$c;")&&(c=c.replace("$c;",""),a.paintCircle(b,e));c.contains("$C;")&&(c=c.replace("$C;",""),a.paintCircle(b,d));c.contains("$q;")&&(c=c.replace("$q;",""),a.paintSquare(b,e));
c.contains("$Q;")&&(c=c.replace("$Q;",""),a.paintSquare(b,d));c.contains("$n;")&&(c=c.replace("$n;",""),d.v=0,a.paintArrow(b,d));c.contains("$N;")&&(c=c.replace("$N;",""),e.v=0,a.paintArrow(b,e));c.contains("$s;")&&(c=c.replace("$s;",""),d.v=1,a.paintArrow(b,d));c.contains("$S;")&&(c=c.replace("$S;",""),e.v=1,a.paintArrow(b,e));c.contains("$e;")&&(c=c.replace("$e;",""),d.v=2,a.paintArrow(b,d));c.contains("$E;")&&(c=c.replace("$E;",""),e.v=2,a.paintArrow(b,e));c.contains("$w;")&&(c=c.replace("$w;",
""),d.v=3,a.paintArrow(b,d));c.contains("$W;")&&(c=c.replace("$W;",""),e.v=3,a.paintArrow(b,e));c.contains("$nw;")&&(c=c.replace("$nw;",""),d.v=4,a.paintArrow(b,d));c.contains("$NW;")&&(c=c.replace("$NW;",""),e.v=4,a.paintArrow(b,e));c.contains("$sw;")&&(c=c.replace("$sw;",""),d.v=5,a.paintArrow(b,d));c.contains("$SW;")&&(c=c.replace("$SW;",""),e.v=5,a.paintArrow(b,e));c.contains("$ne;")&&(c=c.replace("$ne;",""),d.v=7,a.paintArrow(b,d));c.contains("$NE;")&&(c=c.replace("$NE;",""),e.v=7,a.paintArrow(b,
e));c.contains("$se;")&&(c=c.replace("$se;",""),d.v=6,a.paintArrow(b,d));c.contains("$SE;")&&(c=c.replace("$SE;",""),e.v=6,a.paintArrow(b,e));c&&a.paintText(c,b)}b.label!=nil&&a.paintText(b.label.toString(),b);b.error&&a.display.errors&&a.paintErrorCircle(b)}}catch(g){throw a.exception(g),g;}};a.paintValueCell=function(b){try{var f=a.canvas.getContext("2d");f.fillStyle=0!=b.color?a.uic.light[b.color]:4E3<b.areas?a.uic.shade4:3E3<b.areas?a.uic.shade3:2E3<b.areas?a.uic.shade2:1E3<b.areas?a.uic.shade1:
a.uic.light[0];0!=(b.flags&16)?f.fillStyle=a.uic.gray:0!=(b.flags&15)&&(f.fillStyle=a.uic.light[b.flags&15]);if("clueless-1"==a.level.layout||"clueless-2"==a.level.layout){if(0==Math.floor(b.x/9)%2&&1==Math.floor(b.y/9)%2||1==Math.floor(b.x/9)%2&&0==Math.floor(b.y/9)%2)f.fillStyle=a.uic.shade1;"clueless-1"==a.level.layout&&1==b.x%3&&1==b.y%3&&(f.fillStyle=a.uic.shade2);"clueless-2"!=a.level.layout||3!=b.x%9&&4!=b.x%9&&5!=b.x%9||3!=b.y%9&&4!=b.y%9&&5!=b.y%9||(f.fillStyle=a.uic.shade3)}a.bgimage||f.fillRect(b.px,
b.py,a.unit.x,a.unit.y);a.level.options.contains("diagonals")&&(b.x==b.y&&a.paintDiagonal(b,1),b.x==a.size.y-b.y-1&&a.paintDiagonal(b,2));b.pathnum&&b.pathnum!=nil&&a.paintCellPath(b);0!=b.flags&&a.paintCellMarkers(b);b.text&&a.paintCellText(b);a.paintSymbolMarkers(b);a.paintValueMarkers(b);a.variant.is(a.variant.oe)&&1==b.clues&&a.paintCircle(b,{stroke:a.uic.grid});if(b.value!=nil){var e=b.error&&b.error!=n.op&&a.display.errors?a.uic.error:b.fixed?a.uic.clue:a.uic.text;b.fixed&&a.bgimage||a.paintText(b.value.toString(),
b,{color:e})}b.error&&a.display.errors&&(b.value==nil?a.paintErrorDot(b):a.paintErrorCircle(b))}catch(d){throw a.exception(d),d;}};a.paintCellMarkers=function(b){try{a.canvas.getContext("2d");var f={width:1,color:a.uic.markers,stroke:a.uic.markers,fill:a.uic.none};0!=(b.flags&32)&&a.paintCircle(b,f);0!=(b.flags&64)&&a.paintSquare(b,f);0!=(b.flags&128)&&a.paintDot(b,f)}catch(e){throw a.exception(e),e;}};a.paintCellPathArrow=function(b,f,e,d){var c=a.canvas.getContext("2d"),g=a.unit.x/3;b=Math.atan2(d-
f,e-b);c.moveTo(e,d);c.lineTo(e-g*Math.cos(b-Math.PI/7),d-g*Math.sin(b-Math.PI/7));c.moveTo(e-g*Math.cos(b+Math.PI/7),d-g*Math.sin(b+Math.PI/7));c.lineTo(e,d);c.lineTo(e-g*Math.cos(b-Math.PI/7),d-g*Math.sin(b-Math.PI/7))};a.paintCellPath=function(b){try{var f=a.canvas.getContext("2d"),e=b.x,d=b.y,c=a.unit.x/2,g=a.unit.y/2,h=a.unit.x/10,m=b.px+c,l=b.py+g;f.lineWidth=a.unit.x/4;f.strokeStyle=a.uic.path;f.fillStyle=a.uic.path;f.lineCap="round";f.beginPath();0<d&&1==Math.abs(b.pathnum-k[e][d-1].pathnum)&&
(f.moveTo(m,l),f.lineTo(m,l-g),4==b.pathinfo&&a.paintCellPathArrow(m,l-g,m,l+h));d<p-1&&1==Math.abs(b.pathnum-k[e][d+1].pathnum)&&(f.moveTo(m,l),f.lineTo(m,l+g),4==b.pathinfo&&a.paintCellPathArrow(m,l+g,m,l-h));0<e&&1==Math.abs(b.pathnum-k[e-1][d].pathnum)&&(f.moveTo(m,l),f.lineTo(m-c,l),4==b.pathinfo&&a.paintCellPathArrow(m-c,l,m+h,l));e<q-1&&1==Math.abs(b.pathnum-k[e+1][d].pathnum)&&(f.moveTo(m,l),f.lineTo(m+c,l),4==b.pathinfo&&a.paintCellPathArrow(m+c,l,m-h,l));d<p-1&&e<q-1&&1==Math.abs(b.pathnum-
k[e+1][d+1].pathnum)&&(f.moveTo(m,l),f.lineTo(m+c,l+g),4==b.pathinfo&&a.paintCellPathArrow(m+c,l+g,m-h,l-h,1));0<d&&0<e&&1==Math.abs(b.pathnum-k[e-1][d-1].pathnum)&&(f.moveTo(m,l),f.lineTo(m-c,l-g),4==b.pathinfo&&a.paintCellPathArrow(m-c,l-g,m+h,l+h,1));0<d&&e<q-1&&1==Math.abs(b.pathnum-k[e+1][d-1].pathnum)&&(f.moveTo(m,l),f.lineTo(m+c,l-g),4==b.pathinfo&&a.paintCellPathArrow(m+c,l-g,m-h,l+h,1));d<p-1&&0<e&&1==Math.abs(b.pathnum-k[e-1][d+1].pathnum)&&(f.moveTo(m,l),f.lineTo(m-c,l+g),4==b.pathinfo&&
a.paintCellPathArrow(m-c,l+g,m+h,l-h,1));f.stroke();var n={scale:70,fill:a.uic.path,stroke:a.uic.path};1==b.pathinfo&&a.paintCircle(b,n);2==b.pathinfo&&a.paintSquare(b,n)}catch(x){throw a.exception(x),x;}};a.paintCellText=function(b){try{var f=a.canvas.getContext("2d"),e={scale:50,fill:a.uic.markfill,stroke:a.uic.markedge},d={scale:50,fill:a.uic.none,stroke:a.uic.markedge},c=b.text;c.contains("$c;")&&(c=c.replace("$c;",""),a.paintCircle(b,e));c.contains("$C;")&&(c=c.replace("$C;",""),a.paintCircle(b,
d));c.contains("$q;")&&(c=c.replace("$q;",""),a.paintSquare(b,e));c.contains("$Q;")&&(c=c.replace("$Q;",""),a.paintSquare(b,d));c.contains("$n;")&&(c=c.replace("$n;",""),d.v=0,a.paintArrow(b,d));c.contains("$N;")&&(c=c.replace("$N;",""),e.v=0,a.paintArrow(b,e));c.contains("$s;")&&(c=c.replace("$s;",""),d.v=1,a.paintArrow(b,d));c.contains("$S;")&&(c=c.replace("$S;",""),e.v=1,a.paintArrow(b,e));c.contains("$e;")&&(c=c.replace("$e;",""),d.v=2,a.paintArrow(b,d));c.contains("$E;")&&(c=c.replace("$E;",
""),e.v=2,a.paintArrow(b,e));c.contains("$w;")&&(c=c.replace("$w;",""),d.v=3,a.paintArrow(b,d));c.contains("$W;")&&(c=c.replace("$W;",""),e.v=3,a.paintArrow(b,e));c.contains("$nw;")&&(c=c.replace("$nw;",""),d.v=4,a.paintArrow(b,d));c.contains("$NW;")&&(c=c.replace("$NW;",""),e.v=4,a.paintArrow(b,e));c.contains("$sw;")&&(c=c.replace("$sw;",""),d.v=5,a.paintArrow(b,d));c.contains("$SW;")&&(c=c.replace("$SW;",""),e.v=5,a.paintArrow(b,e));c.contains("$ne;")&&(c=c.replace("$ne;",""),d.v=7,a.paintArrow(b,
d));c.contains("$NE;")&&(c=c.replace("$NE;",""),e.v=7,a.paintArrow(b,e));c.contains("$se;")&&(c=c.replace("$se;",""),d.v=6,a.paintArrow(b,d));c.contains("$SE;")&&(c=c.replace("$SE;",""),e.v=6,a.paintArrow(b,e));c&&a.paintText(b.text,f,{color:a.uic.nodetext,size:Math.max(Math.floor(a.unit.y/3),12),align:"left",x:b.px+2,y:b.py+2,w:0,h:Math.max(Math.floor(a.unit.y/3),12)})}catch(g){throw a.exception(g),g;}};a.paintNode=function(b){try{Object.getPrototypeOf(this).paintNode.call(this,b),b.text&&a.paintText(b.text,
a.canvas.getContext("2d"),{color:a.uic.nodetext,clear:a.uic.nodefill,size:Math.max(Math.floor(a.unit.y/3),12),bold:!0,x:b.px-a.unit.x,y:b.py-a.unit.y,w:2*a.unit.x,h:2*a.unit.y})}catch(f){throw a.exception(f),f;}};a.paintHLine=function(b){try{if(Object.getPrototypeOf(this).paintHLine.call(this,b),b.text)if("\u2022"==b.text){var f=a.canvas.getContext("2d");f.fillStyle=a.uic.nodetext;f.beginPath();f.arc(b.px+a.unit.x/2,b.py,a.unit.x/8,0,2*Math.PI);f.fill()}else a.paintText(b.text,a.canvas.getContext("2d"),
{color:a.uic.nodetext,clear:a.uic.nodefill,size:Math.max(Math.floor(a.unit.y/3),12),bold:!0,x:b.px,y:b.py-a.unit.y,w:a.unit.x,h:2*a.unit.y})}catch(e){throw a.exception(e),e;}};a.paintVLine=function(b){try{if(Object.getPrototypeOf(this).paintVLine.call(this,b),b.text)if("\u2022"==b.text){var f=a.canvas.getContext("2d");f.fillStyle=a.uic.nodetext;f.beginPath();f.arc(b.px,b.py+a.unit.y/2,a.unit.x/8,0,2*Math.PI);f.fill()}else a.paintText(b.text,a.canvas.getContext("2d"),{color:a.uic.nodetext,clear:a.uic.nodefill,
size:Math.max(Math.floor(a.unit.y/3),12),bold:!0,x:b.px-a.unit.x,y:b.py,w:2*a.unit.x,h:a.unit.y})}catch(e){throw a.exception(e),e;}};a.paintArrow=function(b,f){try{if(f=a.defaultParams(b,f)){b.px?(void 0===f.v&&(f.v=b.label),b=a.canvas.getContext("2d")):f.v||(f.v=0);f.scale||(f.scale=75);b.strokeStyle=f.stroke?f.stroke:a.uic.arrowedge;b.fillStyle=f.fill?f.fill:a.uic.arrowfill;b.lineWidth=f.width?f.width:1;var e=[[50,95,75,75,25,25,5],[50,95,75,75,25,25,5],[95,50,50,5,5,50,50],[5,50,50,95,95,50,50],
[5,75,60,95,55,20,5],[5,20,55,95,60,75,5],[45,80,95,95,25,40,5],[25,95,95,80,45,5,40]],d=[[5,50,50,95,95,50,50],[95,50,50,5,5,50,50],[50,95,75,75,25,25,5],[50,95,75,75,25,25,5],[5,5,20,55,95,60,75],[25,40,5,45,75,95,95],[5,40,25,95,95,80,45],[5,5,75,60,95,55,20]],c=Math.floor(f.w/5),g=f.w-c-c,h=f.x+c,k=f.y+c,l=e[f.v].length-1;b.beginPath();b.moveTo(h+e[f.v][l]*g/100,k+d[f.v][l]*g/100);for(c=0;c<=l;c++)b.lineTo(h+e[f.v][c]*g/100,k+d[f.v][c]*g/100);b.fillStyle!=a.uic.none&&b.fill();b.strokeStyle!=a.uic.none&&
b.stroke()}}catch(r){throw a.exception(r),r;}};a.paintDone=function(){try{a.variant.is(a.variant.gt)?a.paintGT():a.variant.is(a.variant.kropki)?a.paintKropki():(a.variant.is(a.variant.mn)||a.variant.is(a.variant.cs))&&a.paintWalls()}catch(b){throw a.exception(b),b;}};a.paintGT=function(){try{var b=a.canvas.getContext("2d");b.lineWidth=1;b.fillStyle=a.uic.light[0];b.strokeStyle=a.uic.black;for(var f=Math.floor(a.unit.x/4),e=Math.floor(a.unit.x/9),d=0;d<a.size.x;d++)for(var c=0;c<a.size.y;c++){var g=
k[d][c];0!=(g.clues&4)&&(b.beginPath(),b.moveTo(g.px-e,g.py+f),b.lineTo(g.px+e,g.py+2*f),b.lineTo(g.px-e,g.py+3*f),b.fill(),b.stroke());0!=(g.clues&8)&&(b.beginPath(),b.moveTo(g.px+f,g.py-e),b.lineTo(g.px+2*f,g.py+e),b.lineTo(g.px+3*f,g.py-e),b.fill(),b.stroke());0!=(g.clues&1)&&(b.beginPath(),b.moveTo(g.px+a.unit.x+e,g.py+f),b.lineTo(g.px+a.unit.x-e,g.py+2*f),b.lineTo(g.px+a.unit.x+e,g.py+3*f),b.fill(),b.stroke());0!=(g.clues&2)&&(b.beginPath(),b.moveTo(g.px+f,g.py+a.unit.y+e),b.lineTo(g.px+2*f,
g.py+a.unit.y-e),b.lineTo(g.px+3*f,g.py+a.unit.y+e),b.fill(),b.stroke())}}catch(h){throw a.exception(h),h;}};a.paintKropki=function(){try{var b=a.canvas.getContext("2d");b.strokeStyle=a.uic.black;b.lineWidth=1;for(var f=a.unit.x/8,e=0;e<a.size.x;e++)for(var d=0;d<a.size.y;d++){var c=k[e][d];e!=a.size.x-1&&(0!=(c.clues&1)?(b.fillStyle=a.uic.black,b.beginPath(),b.arc(c.px+a.unit.x,c.py+a.unit.y/2,f,0,2*Math.PI),b.fill(),b.stroke()):0!=(c.clues&4)&&(b.fillStyle=a.uic.white,b.beginPath(),b.arc(c.px+a.unit.x,
c.py+a.unit.y/2,f,0,2*Math.PI),b.fill(),b.stroke()));d!=a.size.y-1&&(0!=(c.clues&2)?(b.fillStyle=a.uic.black,b.beginPath(),b.arc(c.px+a.unit.x/2,c.py+a.unit.y,f,0,2*Math.PI),b.fill(),b.stroke()):0!=(c.clues&8)&&(b.fillStyle=a.uic.white,b.beginPath(),b.arc(c.px+a.unit.x/2,c.py+a.unit.y,f,0,2*Math.PI),b.fill(),b.stroke()))}}catch(g){throw a.exception(g),g;}};a.paintWalls=function(){try{var b=a.canvas.getContext("2d");b.strokeStyle=a.uic.wall;b.lineWidth=a.uim.wall;for(var f=a.unit.x/5,e=0;e<a.size.x;e++)for(var d=
0;d<a.size.y;d++){var c=k[e][d];0!=(c.clues&1)&&e!=a.size.x-1&&(b.beginPath(),b.moveTo(c.px+a.unit.x,c.py+f),b.lineTo(c.px+a.unit.x,c.py+a.unit.y-f),b.stroke());0!=(c.clues&2)&&d!=a.size.y-1&&(b.beginPath(),b.moveTo(c.px+f,c.py+a.unit.y),b.lineTo(c.px+a.unit.x-f,c.py+a.unit.y),b.stroke())}}catch(g){throw a.exception(g),g;}}}Sudoku.prototype=new Puzzle;
