function Country(){var a=this;a.constructor();a.uis.puzzle=["Country Road"];var e=a.board.c,r=0,t=0,l=0,m=0,f=nil,k=nil;a.charToValue=a.charToValue.concat(["-",nil,"/",nil,".",0,"o",0,",",16,"x",16]);a.enable.dragging=!0;a.keypad.left=nil;a.cell.nilalias=16;a.init=function(){Object.getPrototypeOf(a).init.call(a)};a.reset2=function(){try{r=a.labels.west;t=a.labels.north;l=a.size.x-a.labels.east;m=a.size.y-a.labels.south;a.level.areas&&a.reset2areas(r,t,l,m,a.level.areas);if(a.level.problem){var c=
0;var b=a.level.problem.replace(/\s+/g," ").trim().split(" ");for(var d=0;d<m;d++)for(var g=0;g<l;g++){var q=b[c++];var h=e[g][d];"."==q||"-"==q?h.value=nil:"x"==q?h.value=16:"@"==q?(h.areas=a.cell.outside,h.fixed=!0,h.valid=!1):h.label=parseInt(q);h.value!=nil&&(h.fixed=!0)}}if(a.level.solution)for(c=0,b=a.level.solution.replace(/\s+/g," ").trim().split(" "),d=0;d<m;d++)for(g=0;g<l;g++)if(h=e[g][d],q=b[c++],"-"==q||"."==q)h.solution=nil;else{var n=0;q.contains("n")&&(n|=1);q.contains("s")&&(n|=4);
q.contains("e")&&(n|=2);q.contains("w")&&(n|=8);0!=n&&(h.solution=n)}}catch(p){throw a.exception(p),p;}};a.check2=function(){try{for(var c=1,b=0;b<l;b++)for(var d=0;d<m;d++){var g=e[b][d];0==g.count&&16!=g.value&&0!=g.value&&g.value!=nil&&a.markPath(g,c++)}2!=c&&(a.solved=!1);for(b=0;b<l;b++)for(d=0;d<m;d++)g=e[b][d],0==g.value&&(g.error=4);for(b=0;b<l;b++)for(d=0;d<m;d++){var q=e[b][d];if(q.value==nil||16==q.value)b<l-1&&e[b][d].areas!=a.cell.outside&&e[b+1][d].areas!=a.cell.outside&&e[b+1][d].areas!=
e[b][d].areas&&(e[b+1][d].value==nil||16==e[b+1][d].value)&&(e[b][d].error=e[b+1][d].error=5),d<m-1&&e[b][d].areas!=a.cell.outside&&e[b][d+1].areas!=a.cell.outside&&e[b][d+1].areas!=e[b][d].areas&&(e[b][d+1].value==nil||16==e[b][d+1].value)&&(e[b][d].error=e[b][d+1].error=5)}for(b=0;b<l;b++)for(d=0;d<m;d++)e[b][d].count1=0;for(b=0;b<l;b++)for(d=0;d<m;d++){var h=e[b][d];if(b<l-1){var n=e[b+1][d];if(h.areas!=n.areas&&h.value!=nil&&n.value!=nil&&0!=(h.value&2)&&0!=(n.value&8))for(var p=0;p<l;p++)for(var f=
0;f<m;f++){var k=e[p][f];k.areas!=h.areas&&k.areas!=n.areas||k.count1++}}if(d<m-1&&(n=e[b][d+1],h.areas!=n.areas&&h.value!=nil&&n.value!=nil&&0!=(h.value&4)&&0!=(n.value&1)))for(p=0;p<l;p++)for(f=0;f<m;f++)k=e[p][f],k.areas!=h.areas&&k.areas!=n.areas||k.count1++}for(b=0;b<l;b++)for(d=0;d<m;d++)g=e[b][d],g.areas!=a.cell.outside&&2!=g.count1&&(g.error=3);for(b=0;b<l;b++)for(d=0;d<m;d++)if(e[b][d].label!=nil){g=0;var r=e[b][d].areas;for(p=0;p<l;p++)for(f=0;f<m;f++)e[p][f].areas==r&&e[p][f].value!=nil&&
0!=(e[p][f].value&15)&&g++;g!=e[b][d].label&&(e[b][d].error=2,e[b][d].marked=!0)}}catch(u){throw a.exception(u),u;}};a.markPath=function(c,b){try{if(c.value!=nil){c.count=b;if(2==c.value||8==c.value||1==c.value||4==c.value)c.error=1;if(0!=(c.value&8))if(0==c.x)c.error=1;else{var d=e[c.x-1][c.y];d.value==nil||0==(d.value&2)?c.error=1:0==d.count&&a.markPath(d,b)}0!=(c.value&2)&&(c.x==l-1?c.error=1:(d=e[c.x+1][c.y],d.value==nil||0==(d.value&8)?c.error=1:0==d.count&&a.markPath(d,b)));0!=(c.value&1)&&
(0==c.y?c.error=1:(d=e[c.x][c.y-1],d.value==nil||0==(d.value&4)?c.error=1:0==d.count&&a.markPath(d,b)));0!=(c.value&4)&&(c.y==m-1?c.error=1:(d=e[c.x][c.y+1],d.value==nil||0==(d.value&1)?c.error=1:0==d.count&&a.markPath(d,b)))}}catch(g){throw a.exception(g),g;}};a.makeMove2=function(c,b,d){try{if(void 0===b||null==b)b=a.current.value==c.value||a.current.value!=nil&&0!=a.current.value&&16!=a.current.value?c.value==nil?0:0==c.value?16:nil:a.current.value;Object.getPrototypeOf(this).makeMove2.call(this,
c,b,d)}catch(g){throw a.exception(g),g;}};a.makeMove2Alt=function(c,b,d){try{if(void 0===b||null==b)b=a.current.value==c.value||a.current.value!=nil&&0!=a.current.value&&16!=a.current.value?c.value==nil?16:16==c.value?0:nil:a.current.value;Object.getPrototypeOf(this).makeMove2.call(this,c,b,d)}catch(g){throw a.exception(g),g;}};a.dragTo2=function(c,b){try{if(!c.fixed&&c.areas!=a.cell.outside){if(c.x==b.x-1&&b.y==c.y){switch(b.value){case nil:case 16:case 0:a.makeMove(b,8);break;case 10:a.makeMove(b,
10);break;case 12:a.makeMove(b,12);break;case 9:a.makeMove(b,9);break;case 1:a.makeMove(b,9);break;case 2:a.makeMove(b,10);break;case 4:a.makeMove(b,12);break;case 8:a.makeMove(b,8);break;case 5:k==b.y-1?a.makeMove(b,9):k==b.y+1?a.makeMove(b,12):a.makeMove(b,8);break;case 3:k==b.y-1?a.makeMove(b,9):f==b.x+1?a.makeMove(b,10):a.makeMove(b,8);break;case 6:k==b.y+1?a.makeMove(b,12):f==b.x+1?a.makeMove(b,10):a.makeMove(b,8)}switch(c.value){case nil:case 16:case 0:a.makeMove(c,2);break;case 5:a.makeMove(c,
2);break;case 10:a.makeMove(c,10);break;case 3:a.makeMove(c,3);break;case 6:a.makeMove(c,6);break;case 12:a.makeMove(c,2);break;case 9:a.makeMove(c,2);break;case 1:a.makeMove(c,3);break;case 2:a.makeMove(c,2);break;case 4:a.makeMove(c,6);break;case 8:a.makeMove(c,10)}}if(c.x==b.x+1&&b.y==c.y){switch(b.value){case nil:case 16:case 0:a.makeMove(b,2);break;case 10:a.makeMove(b,10);break;case 3:a.makeMove(b,3);break;case 6:a.makeMove(b,6);break;case 1:a.makeMove(b,3);break;case 2:a.makeMove(b,2);break;
case 4:a.makeMove(b,6);break;case 8:a.makeMove(b,10);break;case 5:k==b.y-1?a.makeMove(b,3):k==b.y+1?a.makeMove(b,6):a.makeMove(b,2);break;case 12:f==b.x-1?a.makeMove(b,10):k==b.y+1?a.makeMove(b,6):a.makeMove(b,2);break;case 9:k==b.y-1?a.makeMove(b,3):f==b.x-1?a.makeMove(b,10):a.makeMove(b,2)}switch(c.value){case nil:case 16:case 0:a.makeMove(c,8);break;case 5:a.makeMove(c,8);break;case 10:a.makeMove(c,10);break;case 3:a.makeMove(c,8);break;case 6:a.makeMove(c,8);break;case 12:a.makeMove(c,12);break;
case 9:a.makeMove(c,9);break;case 1:a.makeMove(c,9);break;case 2:a.makeMove(c,10);break;case 4:a.makeMove(c,12);break;case 8:a.makeMove(c,8)}}if(c.y==b.y+1&&b.x==c.x){switch(b.value){case nil:case 16:case 0:a.makeMove(b,4);break;case 6:a.makeMove(b,6);break;case 12:a.makeMove(b,12);break;case 1:a.makeMove(b,5);break;case 2:a.makeMove(b,6);break;case 4:a.makeMove(b,4);break;case 8:a.makeMove(b,12);break;case 5:a.makeMove(b,5);break;case 10:f==b.x-1?a.makeMove(b,12):f==b.x+1?a.makeMove(b,6):a.makeMove(b,
4);break;case 3:k==b.y-1?a.makeMove(b,5):f==b.x+1?a.makeMove(b,6):a.makeMove(b,4);break;case 9:f==b.x-1?a.makeMove(b,12):k==b.y-1?a.makeMove(b,5):a.makeMove(b,4)}switch(c.value){case nil:case 16:case 0:a.makeMove(c,1);break;case 5:a.makeMove(c,5);break;case 10:a.makeMove(c,1);break;case 3:a.makeMove(c,3);break;case 6:a.makeMove(c,1);break;case 12:a.makeMove(c,1);break;case 9:a.makeMove(c,9);break;case 1:a.makeMove(c,1);break;case 2:a.makeMove(c,3);break;case 4:a.makeMove(c,5);break;case 8:a.makeMove(c,
9)}}if(c.y==b.y-1&&b.x==c.x){switch(b.value){case nil:case 16:case 0:a.makeMove(b,1);break;case 5:a.makeMove(b,5);break;case 3:a.makeMove(b,3);break;case 9:a.makeMove(b,9);break;case 1:a.makeMove(b,1);break;case 2:a.makeMove(b,3);break;case 4:a.makeMove(b,5);break;case 8:a.makeMove(b,9);break;case 10:f==b.x-1?a.makeMove(b,9):f==b.x+1?a.makeMove(b,3):a.makeMove(b,1);break;case 6:k==b.y+1?a.makeMove(b,5):f==b.x+1?a.makeMove(b,6):a.makeMove(b,4);break;case 12:f==b.x-1?a.makeMove(b,3):k==b.y+1?a.makeMove(b,
5):a.makeMove(b,4)}switch(c.value){case nil:case 16:case 0:a.makeMove(c,4);break;case 5:a.makeMove(c,5);break;case 10:a.makeMove(c,4);break;case 3:a.makeMove(c,4);break;case 6:a.makeMove(c,6);break;case 12:a.makeMove(c,12);break;case 9:a.makeMove(c,4);break;case 1:a.makeMove(c,5);break;case 2:a.makeMove(c,6);break;case 4:a.makeMove(c,4);break;case 8:a.makeMove(c,12)}}f=b.x;k=b.y;a.moveTo(c)}}catch(d){throw a.exception(d),d;}};a.dragTo2Alt=function(c,b){try{b.value!=nil&&a.makeMove(b,nil,a.current.color),
c.value!=nil&&a.makeMove(c,nil,a.current.color),a.moveTo(c)}catch(d){throw a.exception(d),d;}};a.valueToString=function(a,b){switch(a){case 16:return b?"x":"-";case 15:return"nsew";case 0:return"o";case 4:return"s";case 1:return"n";case 2:return"e";case 8:return"w";case 3:return"ne";case 9:return"nw";case 6:return"se";case 12:return"sw";case 5:return"ns";case 10:return"ew";default:return"-"}};a.paintCell=function(c){try{var b=a.canvas.getContext("2d");b.fillStyle=a.uic.light[0];b.fillRect(c.px,c.py,
a.unit.x,a.unit.y);if(c.value!=nil){var d=Math.floor((a.unit.x-Math.floor(a.unit.x/4))/2),e=a.unit.x-2*d,f=e+d;b.fillStyle=a.display.errors&&0<c.count?a.uic.dark[(c.count-1)%10]:!a.display.errors||1!=c.error&&3!=c.error?0==c.color?a.uic.line:a.uic.dark[c.color]:a.uic.error;16!=c.value||a.solved||a.paintCross(c);0==c.value&&b.fillRect(c.px+d,c.py+d,e,e);0!=(c.value&1)&&b.fillRect(c.px+d,c.py,e,f);0!=(c.value&4)&&b.fillRect(c.px+d,c.py+d,e,f);0!=(c.value&2)&&b.fillRect(c.px+d,c.py+d,f,e);0!=(c.value&
8)&&b.fillRect(c.px,c.py+d,f,e)}a.paintSymbolMarkers(c);c.error&&a.display.errors&&c.value==nil&&a.paintErrorDot(c);c.label!=nil&&(b.fillStyle=2==c.error&&a.display.errors?a.uic.error:a.uic.text,b.textAlign="center",b.textBaseline="middle",b.font="bold "+Math.floor(45*a.unit.x/100).toString()+"px sans-serif",b.fillText(c.label.toString(),c.px+a.unit.x/4,c.py+a.unit.y/4+2))}catch(h){throw a.exception(h),h;}};a.paintCurrentValue=function(){try{var c=a.uie.value,b=c.getContext("2d");b.fillStyle=a.uic.white;
b.fillRect(0,0,c.width,c.height);a.current.value!=nil&&(0==a.current.value?a.paintSquare(b,{x:0,y:0,w:c.width,h:c.height,scale:30,stroke:a.uic.none,fill:a.uic.line}):16==a.current.value?a.paintCross(b,{x:0,y:0,w:c.width,h:c.height,stroke:a.uic.cross,fill:a.uic.cross}):a.paintText("#",b,{x:0,y:0,w:c.width,h:c.height,scale:90,stroke:a.uic.black,fill:a.uic.black}))}catch(d){throw a.exception(d),d;}}}Country.prototype=new Puzzle;
