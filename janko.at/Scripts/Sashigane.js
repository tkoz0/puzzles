function Sashigane(){var b=this;b.constructor();b.uis.puzzle=["Sashigane"];var f=b.board.c,m=b.board.h,n=b.board.v,k=0,l=0;b.line.values=[b.line.wall,b.line.cross,b.line.grid];b.enable.dragging=!0;b.enable.hint=!1;b.enable.cells=!0;b.enable.lines=!0;b.keypad.left=nil;b.init=function(){Object.getPrototypeOf(b).init.call(b)};b.reset2=function(){try{k=b.size.x;l=b.size.y;b.config.touch&&(b.enable.lines=!0,b.enable.cells=!1);b.level.lines&&b.reset2lines(0,0,k,l,b.level.lines);if(b.level.problem){var a=
0;var d=b.level.problem.replace(/\s+/g," ").trim().split(" ");for(var h=0;h<l;h++)for(var g=0;g<k;g++){var e=f[g][h];var c=d[a++];"-"!=c&&"."!=c&&("@"==c?(e.areas=b.cell.outside,e.fixed=!0,e.valid=!1):e.label="n"==c?nil-8:"s"==c?nil-2:"e"==c?nil-1:"w"==c?nil-4:parseInt(c))}}if(b.level.solution){a=0;d=b.level.solution.replace(/\s+/g," ").trim().split(" ");for(h=0;h<l;h++)for(g=0;g<k;g++)e=f[g][h],c=d[a++],e.count="."==c||"-"==c?nil:parseInt(c);c=1;for(g=0;g<k;g++)for(h=0;h<l;h++)if(f[g][h].count!=
nil){var p=f[g][h].count;for(d=0;d<k;d++)for(var q=0;q<l;q++)e=f[d][q],e.count==p&&(e.solution=c,e.count=nil);c++}for(g=1;g<k;g++)for(h=0;h<l;h++)n[g][h].solution=f[g][h].solution!=f[g-1][h].solution?b.line.wall:b.line.grid;for(h=1;h<l;h++)for(g=0;g<k;g++)m[g][h].solution=f[g][h].solution!=f[g][h-1].solution?b.line.wall:b.line.grid}for(a=0;a<b.board.l.length;a++)b.board.l[a].value!=nil&&(b.board.l[a].fixed=!0);for(g=0;g<k;g++)m[g][0].valid=m[g][l].valid=!1,m[g][0].value=m[g][0].solution=m[g][l].value=
m[g][l].solution=b.line.wall;for(h=0;h<l;h++)n[0][h].valid=n[k][h].valid=!1,n[0][h].value=n[0][h].solution=n[k][h].value=n[k][h].solution=b.line.wall}catch(r){throw b.exception(r),r;}};b.check2=function(){var a,d;try{var h=function(a,c,d){try{f[a][c].count=d,0!=a&&0==f[a-1][c].count&&n[a][c].value!=b.line.wall&&h(a-1,c,d),a!=k-1&&0==f[a+1][c].count&&n[a+1][c].value!=b.line.wall&&h(a+1,c,d),0!=c&&0==f[a][c-1].count&&m[a][c].value!=b.line.wall&&h(a,c-1,d),c!=l-1&&0==f[a][c+1].count&&m[a][c+1].value!=
b.line.wall&&h(a,c+1,d)}catch(t){throw b.exception(t),t;}};var g=1;for(var e=0;e<k;e++)for(var c=0;c<l;c++)0==f[e][c].count&&h(e,c,g++);for(e=0;e<k;e++)for(c=0;c<l;c++){var p=0;n[e][c].value==b.line.wall&&(p+=4);m[e][c].value==b.line.wall&&(p+=8);n[e+1][c].value==b.line.wall&&(p+=1);m[e][c+1].value==b.line.wall&&(p+=2);if(9==p||12==p||3==p||6==p)f[e][c].marked=!0}for(e=0;e<k;e++)for(c=0;c<l;c++){var q=f[e][c].count;g=0;0<e&&f[e-1][c].count==q&&g++;0<c&&f[e][c-1].count==q&&g++;e<k-1&&f[e+1][c].count==
q&&g++;c<l-1&&f[e][c+1].count==q&&g++;1!=g&&2!=g&&(f[e][c].error=1)}for(e=0;e<k;e++)for(c=0;c<l;c++)f[e][c].label>nil&&!f[e][c].marked&&(f[e][c].error=4);for(e=0;e<k;e++)for(c=0;c<l;c++)if(0<f[e][c].label){for(d=g=0;d<k;d++)for(a=0;a<l;a++)f[d][a].count==f[e][c].count&&g++;f[e][c].label!=g&&(f[e][c].error=2)}for(e=0;e<k;e++)for(c=0;c<l;c++)if(!f[e][c].checked){for(d=g=0;d<k;d++)for(a=0;a<l;a++)f[d][a].count==f[e][c].count&&(f[d][a].checked=!0,f[d][a].marked&&g++);if(1!=g)for(d=0;d<k;d++)for(a=0;a<
l;a++)f[d][a].count==f[e][c].count&&(f[d][a].error=1)}for(e=0;e<k;e++)for(c=0;c<l;c++)f[e][c].label<nil&&(g=0,n[e][c].value==b.line.wall&&g++,m[e][c].value==b.line.wall&&g++,n[e+1][c].value==b.line.wall&&g++,m[e][c+1].value==b.line.wall&&g++,3!=g&&(f[e][c].error=3));for(e=0;e<k;e++)for(c=0;c<l;c++)if(f[e][c].label<nil){p=g=0;f[e][c].label==nil-8&&(p=-1);f[e][c].label==nil-2&&(p=1);f[e][c].label==nil-1&&(g=1);f[e][c].label==nil-4&&(g=-1);q=!1;d=e;for(a=c;;)if(0<=d+g&&d+g<k&&0<=a+p&&a+p<l){d+=g;a+=
p;if(f[d][a].count!=f[e][c].count)break;if(f[d][a].marked){q=!0;break}}else break;q||(f[e][c].error=3)}}catch(r){throw b.exception(r),r;}};b.solve2=function(){for(var a=0;a<k;a++)for(var d=0;d<l;d++)if(f[a][d].label<nil){var h=Math.abs(f[a][d].label)-1;4!=h&&(n[a][d].value=b.line.wall);8!=h&&(m[a][d].value=b.line.wall);1!=h&&(n[a+1][d].value=b.line.wall);2!=h&&(m[a][d+1].value=b.line.wall)}for(a=0;a<k;a++)for(d=0;d<l;d++)f[a][d].label>nil&&(a<k-1&&f[a+1][d].label>nil&&(n[a+1][d].value=b.line.wall),
d<l-1&&f[a][d+1].label>nil&&(m[a][d+1].value=b.line.wall))};b.cleanSolution=function(){for(var a=0;a<k;a++)for(var d=0;d<l;d++)f[a][d].value=f[a][d].count;for(a=1;a<k;a++)for(d=0;d<l;d++)n[a][d].value=f[a][d].value!=f[a-1][d].value?b.line.wall:b.line.grid;for(d=1;d<l;d++)for(a=0;a<k;a++)m[a][d].value=f[a][d].value!=f[a][d-1].value?b.line.wall:b.line.grid};b.showSolution2=function(){try{for(var a=0;a<b.board.l.length;a++)b.board.l[a].value=b.board.l[a].solution}catch(d){throw b.exception(d),d;}};b.labelToString=
function(a,d){try{switch(a){case nil-8:return"n";case nil-2:return"s";case nil-1:return"e";case nil-4:return"w";default:return b.numberToString(a)}}catch(h){return ojdebug(h.toString()),"%"}};b.onValues=function(){try{b.config.touch&&(b.enable.lines?(b.enable.lines=!1,b.enable.cells=!0):(b.enable.lines=!0,b.enable.cells=!1))}catch(a){throw b.exception(a),a;}};b.paintCell=function(a){try{var d=b.canvas.getContext("2d");d.fillStyle=b.uic.light[a.color];d.fillRect(a.px,a.py,b.unit.x,b.unit.y);if(a.label<
nil){var f={arrow:Math.abs(a.label)-1};f.fill=b.display.errors&&3==a.error?f.stroke=b.uic.error:f.stroke=b.uic.black;b.paintArrow(a,f)}else if(a.label>nil){var g=10<a.label?40:60;0<a.label&&b.paintText(a.label.toString(),a,{scale:g});b.paintCircle(a)}b.paintSymbolMarkers(a);a.error&&b.display.errors&&(a.label<=nil?b.paintErrorDot(a):a.label>nil&&b.paintErrorCircle(a))}catch(e){throw b.exception(e),e;}};b.paintCurrentValue=function(){try{var a=b.uie.value,d=a.getContext("2d");d.fillStyle=b.uic.white;
d.fillRect(0,0,a.width,a.height);var f={x:0,y:0,w:a.width,h:a.height,color:b.uic.black,bold:!0,scale:80};b.current.value==b.line.wall?b.paintText("\u2014",d,f):b.current.value==b.line.cross?b.paintText("\u00d7",d,f):b.current.value==b.line.grid&&b.paintText("\u2022",d,f)}catch(g){throw b.exception(g),g;}}}Sashigane.prototype=new Puzzle;
