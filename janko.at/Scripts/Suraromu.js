function Suraromu(){var a=this;a.constructor();a.uis.puzzle=["Suraromu"];var l=nil,n=nil;a.charToValue=a.charToValue.concat(["-",nil,"/",nil,".",0,"o",0,",",16,"x",16]);a.enable.dragging=!0;a.keypad.left=nil;a.cell.nilalias=16;a.uic.gate="#000000";a.init=function(){Object.getPrototypeOf(a).init.call(a)};a.reset2=function(){var b,c;try{if(a.level.problem){var d=0;var e=a.level.problem.replace(/\s+/g," ").trim().split(" ");for(var f=0;f<a.size.y;f++)for(var g=0;g<a.size.x;g++){var h=e[d++];var k=a.board.c[g][f];
"."!=h&&"-"!=h&&("#"==h||"x"==h?k.label=0:"o"==h?k.clues=1:"h"==h?k.clues=3:"v"==h?k.clues=2:k.label=parseInt(h));k.label!=nil&&(k.fixed=!0)}}if(a.level.solution)for(d=0,e=a.level.solution.replace(/\s+/g," ").trim().split(" "),f=0;f<a.size.y;f++)for(g=0;g<a.size.x;g++){k=a.board.c[g][f];h=e[d++];var l=0;h.contains("n")&&(l|=1);h.contains("s")&&(l|=4);h.contains("e")&&(l|=2);h.contains("w")&&(l|=8);0!=l&&(k.solution=l)}var m=a.board.c;for(g=0;g<a.size.x;g++)for(f=0;f<a.size.y;f++)if(k=m[g][f],!k.marked&&
k.label!=nil){for(c=g+1;c<a.size.x&&3==m[c][f].clues;)c++;if(c<a.size.x&&m[c][f].label==k.label)for(h=g;h<=c;h++)m[h][f].label=k.label,m[h][f].marked=!0;for(b=f+1;b<a.size.y&&2==m[g][b].clues;)b++;if(b<a.size.y&&m[g][b].label==k.label)for(h=f;h<=b;h++)m[g][h].label=m[g][f].label,m[g][h].marked=!0}for(g=0;g<a.size.x;g++)for(f=0;f<a.size.y;f++)if(k=m[g][f],!k.marked&&k.label!=nil){for(c=g+1;c<a.size.x&&3==m[c][f].clues;)m[c][f].label=k.label,m[c][f].marked=!0,c++;for(c=g-1;0<=c&&3==m[c][f].clues;)m[c][f].label=
k.label,m[c][f].marked=!0,c--;for(b=f+1;b<a.size.y&&2==m[g][b].clues;)m[g][b].label=k.label,m[g][b].marked=!0,b++;for(b=f-1;0<=b&&2==m[g][b].clues;)m[g][b].label=k.label,m[g][b].marked=!0,b--}}catch(p){throw a.exception(p),p;}};a.check2=function(){try{for(var b=a.board.c,c=1,d=0;d<a.size.x;d++)for(var e=0;e<a.size.y;e++){var f=b[d][e];0==f.count&&16!=f.value&&0!=f.value&&f.value!=nil&&a.markPath(f,c++,0)}2!=c&&(a.solved=!1);for(d=0;d<a.size.x;d++)for(e=0;e<a.size.y;e++)f=b[d][e],0==f.value&&(f.error=
3);for(d=0;d<a.size.x;d++)for(e=0;e<a.size.y;e++)if(!b[d][e].marked)if(2==b[d][e].clues){c=e;for(var g=nil;c<a.size.y&&2==b[d][c].clues;)b[d][c].marked=!0,10==b[d][c].value&&(g!=nil&&(b[d][c].error=b[d][g].error=2),g=c),c++;if(g==nil){for(c=e;c<a.size.y&&2==b[d][c].clues;)b[d][c++].error=2;solved=2}}else if(3==b[d][e].clues){c=d;for(g=nil;c<a.size.x&&3==b[c][e].clues;)b[c][e].marked=!0,5==b[c][e].value&&(g!=nil&&(b[c][e].error=b[g][e].error=2),g=c),c++;if(g==nil)for(c=d;c<a.size.x&&3==b[c][e].clues;)b[c++][e].error=
2}c=null;for(d=0;d<a.size.x;d++)for(e=0;e<a.size.y;e++)if(f=b[d][e],1==f.clues&&(c=f,f.value==nil||0==(f.value&15)))f.error=2;if(a.solved){var h=c.work;for(d=c=0;d<a.size.x;d++)for(e=0;e<a.size.y;e++)if(f=b[d][e],0<f.label&&f.value!=nil&&0!=(f.value&15)){var k=f.work-h;0>k&&(k=k+a.size.z+1);var l=a.size.z-f.work+h+1;l>a.size.z&&(l=l-a.size.z-1);if(f.label!=k||f.label!=l)f.label==k&&2!=c?c=1:f.label==l&&1!=c?c=2:f.error=4}}}catch(m){throw a.exception(m),m;}};a.markPath=function(b,c,d){try{if(b.value!=
nil){b.count=c;if(2==b.clues||3==b.clues||1==b.clues)b.work=d++;if(2==b.value||8==b.value||1==b.value||4==b.value)b.error=1;if(0!=(b.value&8))if(0==b.x)b.error=1;else{var e=a.board.c[b.x-1][b.y];e.value==nil||0==(e.value&2)?b.error=1:0==e.count&&a.markPath(e,c,d)}0!=(b.value&2)&&(b.x==a.size.x-1?b.error=1:(e=a.board.c[b.x+1][b.y],e.value==nil||0==(e.value&8)?b.error=1:0==e.count&&a.markPath(e,c,d)));0!=(b.value&1)&&(0==b.y?b.error=1:(e=a.board.c[b.x][b.y-1],e.value==nil||0==(e.value&4)?b.error=1:
0==e.count&&a.markPath(e,c,d)));0!=(b.value&4)&&(b.y==a.size.y-1?b.error=1:(e=a.board.c[b.x][b.y+1],e.value==nil||0==(e.value&1)?b.error=1:0==e.count&&a.markPath(e,c,d)))}}catch(f){throw a.exception(f),f;}};a.makeMove2=function(b,c,d){try{if(void 0===c||null==c)c=a.current.value==b.value||a.current.value!=nil&&0!=a.current.value&&16!=a.current.value?b.value==nil?0:0==b.value?16:nil:a.current.value;Object.getPrototypeOf(this).makeMove2.call(this,b,c,d)}catch(e){throw a.exception(e),e;}};a.makeMove2Alt=
function(b,c,d){try{if(void 0===c||null==c)c=a.current.value==b.value||a.current.value!=nil&&0!=a.current.value&&16!=a.current.value?b.value==nil?16:16==b.value?0:nil:a.current.value;Object.getPrototypeOf(this).makeMove2.call(this,b,c,d)}catch(e){throw a.exception(e),e;}};a.dragTo2=function(b,c){try{if(!b.fixed&&b.areas!=a.cell.outside){if(b.x==c.x-1&&c.y==b.y){switch(c.value){case nil:case 16:case 0:a.makeMove(c,8);break;case 10:a.makeMove(c,10);break;case 12:a.makeMove(c,12);break;case 9:a.makeMove(c,
9);break;case 1:a.makeMove(c,9);break;case 2:a.makeMove(c,10);break;case 4:a.makeMove(c,12);break;case 8:a.makeMove(c,8);break;case 5:n==c.y-1?a.makeMove(c,9):n==c.y+1?a.makeMove(c,12):a.makeMove(c,8);break;case 3:n==c.y-1?a.makeMove(c,9):l==c.x+1?a.makeMove(c,10):a.makeMove(c,8);break;case 6:n==c.y+1?a.makeMove(c,12):l==c.x+1?a.makeMove(c,10):a.makeMove(c,8)}switch(b.value){case nil:case 16:case 0:a.makeMove(b,2);break;case 5:a.makeMove(b,2);break;case 10:a.makeMove(b,10);break;case 3:a.makeMove(b,
3);break;case 6:a.makeMove(b,6);break;case 12:a.makeMove(b,2);break;case 9:a.makeMove(b,2);break;case 1:a.makeMove(b,3);break;case 2:a.makeMove(b,2);break;case 4:a.makeMove(b,6);break;case 8:a.makeMove(b,10)}}if(b.x==c.x+1&&c.y==b.y){switch(c.value){case nil:case 16:case 0:a.makeMove(c,2);break;case 10:a.makeMove(c,10);break;case 3:a.makeMove(c,3);break;case 6:a.makeMove(c,6);break;case 1:a.makeMove(c,3);break;case 2:a.makeMove(c,2);break;case 4:a.makeMove(c,6);break;case 8:a.makeMove(c,10);break;
case 5:n==c.y-1?a.makeMove(c,3):n==c.y+1?a.makeMove(c,6):a.makeMove(c,2);break;case 12:l==c.x-1?a.makeMove(c,10):n==c.y+1?a.makeMove(c,6):a.makeMove(c,2);break;case 9:n==c.y-1?a.makeMove(c,3):l==c.x-1?a.makeMove(c,10):a.makeMove(c,2)}switch(b.value){case nil:case 16:case 0:a.makeMove(b,8);break;case 5:a.makeMove(b,8);break;case 10:a.makeMove(b,10);break;case 3:a.makeMove(b,8);break;case 6:a.makeMove(b,8);break;case 12:a.makeMove(b,12);break;case 9:a.makeMove(b,9);break;case 1:a.makeMove(b,9);break;
case 2:a.makeMove(b,10);break;case 4:a.makeMove(b,12);break;case 8:a.makeMove(b,8)}}if(b.y==c.y+1&&c.x==b.x){switch(c.value){case nil:case 16:case 0:a.makeMove(c,4);break;case 6:a.makeMove(c,6);break;case 12:a.makeMove(c,12);break;case 1:a.makeMove(c,5);break;case 2:a.makeMove(c,6);break;case 4:a.makeMove(c,4);break;case 8:a.makeMove(c,12);break;case 5:a.makeMove(c,5);break;case 10:l==c.x-1?a.makeMove(c,12):l==c.x+1?a.makeMove(c,6):a.makeMove(c,4);break;case 3:n==c.y-1?a.makeMove(c,5):l==c.x+1?a.makeMove(c,
6):a.makeMove(c,4);break;case 9:l==c.x-1?a.makeMove(c,12):n==c.y-1?a.makeMove(c,5):a.makeMove(c,4)}switch(b.value){case nil:case 16:case 0:a.makeMove(b,1);break;case 5:a.makeMove(b,5);break;case 10:a.makeMove(b,1);break;case 3:a.makeMove(b,3);break;case 6:a.makeMove(b,1);break;case 12:a.makeMove(b,1);break;case 9:a.makeMove(b,9);break;case 1:a.makeMove(b,1);break;case 2:a.makeMove(b,3);break;case 4:a.makeMove(b,5);break;case 8:a.makeMove(b,9)}}if(b.y==c.y-1&&c.x==b.x){switch(c.value){case nil:case 16:case 0:a.makeMove(c,
1);break;case 5:a.makeMove(c,5);break;case 3:a.makeMove(c,3);break;case 9:a.makeMove(c,9);break;case 1:a.makeMove(c,1);break;case 2:a.makeMove(c,3);break;case 4:a.makeMove(c,5);break;case 8:a.makeMove(c,9);break;case 10:l==c.x-1?a.makeMove(c,9):l==c.x+1?a.makeMove(c,3):a.makeMove(c,1);break;case 6:n==c.y+1?a.makeMove(c,5):l==c.x+1?a.makeMove(c,6):a.makeMove(c,4);break;case 12:l==c.x-1?a.makeMove(c,3):n==c.y+1?a.makeMove(c,5):a.makeMove(c,4)}switch(b.value){case nil:case 16:case 0:a.makeMove(b,4);
break;case 5:a.makeMove(b,5);break;case 10:a.makeMove(b,4);break;case 3:a.makeMove(b,4);break;case 6:a.makeMove(b,6);break;case 12:a.makeMove(b,12);break;case 9:a.makeMove(b,4);break;case 1:a.makeMove(b,5);break;case 2:a.makeMove(b,6);break;case 4:a.makeMove(b,4);break;case 8:a.makeMove(b,12)}}l=c.x;n=c.y;a.moveTo(b);a.current.value=0}}catch(d){throw a.exception(d),d;}};a.dragTo2Alt=function(b,c){try{c.value!=nil&&a.makeMove(c,nil,a.current.color),b.value!=nil&&a.makeMove(b,nil,a.current.color),a.moveTo(b)}catch(d){throw a.exception(d),
d;}};a.valueToString=function(a,c){switch(a){case 16:return c?"x":"-";case 15:return"nsew";case 0:return"o";case 4:return"s";case 1:return"n";case 2:return"e";case 8:return"w";case 3:return"ne";case 9:return"nw";case 6:return"se";case 12:return"sw";case 5:return"ns";case 10:return"ew";default:return"-"}};a.paintCell=function(b){var c;try{var d=a.canvas.getContext("2d");d.fillStyle=b.label!=nil&&0==b.clues?a.uic.black:a.uic.light[0];d.fillRect(b.px,b.py,a.unit.x,a.unit.y);if(b.value!=nil){var e=Math.floor((a.unit.x-
Math.floor(a.unit.x/4))/2),f=a.unit.x-2*e,g=f+e;d.fillStyle=a.display.errors&&0<b.count?1==b.count?a.uic.line:a.uic.dark[(b.count-1)%10]:a.display.errors&&1==b.error?a.uic.error:0==b.color?a.uic.line:a.uic.dark[b.color];16!=b.value||a.solved||a.paintCross(b);0==b.value&&d.fillRect(b.px+e,b.py+e,f,f);0!=(b.value&1)&&d.fillRect(b.px+e,b.py,f,g);0!=(b.value&4)&&d.fillRect(b.px+e,b.py+e,f,g);0!=(b.value&2)&&d.fillRect(b.px+e,b.py+e,g,f);0!=(b.value&8)&&d.fillRect(b.px,b.py+e,g,f)}a.paintSymbolMarkers(b);
d.lineWidth=2;d.fillStyle=a.uic.none;d.strokeStyle=a.uic.gate;if(1==b.clues)a.paintCircle(b,{stroke:a.uic.gate,scale:90}),a.paintText(a.size.z.toString(),b,{color:a.uic.black,scale:60});else if(2==b.clues){d.beginPath();var h=b.px+a.unit.x/2;for(c=b.py;c<b.py+a.unit.y-4;)d.moveTo(h,c+2),d.lineTo(h,c+4),c+=4;d.stroke()}else if(3==b.clues){d.beginPath();h=b.px;for(c=b.py+a.unit.x/2;h<b.px+a.unit.x-4;)d.moveTo(h+2,c),d.lineTo(h+4,c),h+=4;d.stroke()}0<b.label&&0==b.clues&&a.paintText(b.label.toString(),
b,{color:a.uic.white});b.error&&a.display.errors&&(0!=b.clues?a.paintErrorSquare(b):b.value==nil&&a.paintErrorDot(b))}catch(k){throw a.exception(k),k;}};a.paintCurrentValue=function(){try{var b=a.uie.value,c=b.getContext("2d");c.fillStyle=a.uic.white;c.fillRect(0,0,b.width,b.height);a.current.value!=nil&&(0==a.current.value?a.paintSquare(c,{x:0,y:0,w:b.width,h:b.height,scale:30,stroke:a.uic.none,fill:a.uic.line}):16==a.current.value?a.paintCross(c,{x:0,y:0,w:b.width,h:b.height,stroke:a.uic.cross,
fill:a.uic.cross}):a.paintText("#",c,{x:0,y:0,w:b.width,h:b.height,scale:90,stroke:a.uic.black,fill:a.uic.black}))}catch(d){throw a.exception(d),d;}}}Suraromu.prototype=new Puzzle;
