function Yajilin(){var a=this;a.constructor();a.uis.puzzle=["Yajilin"];var g=a.board.c,l=0,k=0,p=nil,q=nil;a.charToValue=a.charToValue.concat(["-",nil,"/",nil,".",0,"o",0,",",16,"x",16]);a.enable.dragging=!0;a.keypad.left=nil;a.init=function(){Object.getPrototypeOf(a).init.call(a)};a.reset2=function(){try{l=a.size.x;k=a.size.y;a.level.areas&&a.reset2areas(0,0,l,k,a.level.areas);a.enable.pgrid=!0;if(a.level.problem){var c=0;var b=a.level.problem.replace(/\s+/g," ").trim().split(" ");for(var e=0;e<
k;e++)for(var d=0;d<l;d++){var f=g[d][e];var h=b[c++];if("."==h||"-"==h)f.value=f.clues=nil;else if("x"==h||"#"==h)f.clues=64;else if("@"==h)f.areas=a.cell.outside,f.fixed=!0,f.valid=!1,a.enable.pgrid=!1;else{var m=parseInt(h.substr(0,h.length-1)),n=h.substr(h.length-1);f.label=parseInt(m);"n"==n?f.clues=8:"s"==n?f.clues=2:"e"==n?f.clues=1:"w"==n?f.clues=4:"+"==n?f.clues=16:"x"==n?f.clues=32:f.label=parseInt(h)}if(f.clues!=nil||f.value!=nil||f.label!=nil)f.fixed=!0}}if(a.level.solution)for(c=0,b=
a.level.solution.replace(/\s+/g," ").trim().split(" "),e=0;e<k;e++)for(d=0;d<l;d++)f=g[d][e],h=b[c++],"-"==h||"."==h?f.solution=nil:"x"==h?f.solution=16:(m=0,h.contains("n")&&(m|=1),h.contains("s")&&(m|=4),h.contains("e")&&(m|=2),h.contains("w")&&(m|=8),0!=m&&(f.solution=m))}catch(r){throw a.exception(r),r;}};a.check2=function(){try{for(var c=0,b=0;b<l;b++)for(var e=0;e<k;e++){var d=g[b][e];d.checked||16==d.value||0==d.value||d.value==nil||a.markPath(b,e,c++)}if(1!=c)for(a.solved=!1,b=0;b<l;b++)for(e=
0;e<k;e++)4==g[b][e].error&&(g[b][e].error=0);for(b=0;b<l;b++)for(e=0;e<k;e++)d=g[b][e],d.label!=nil&&d.value!=nil&&(d.error=1),d.label!=nil||64==d.clues||d.areas==a.cell.outside||d.value!=nil&&0!=d.value&&2!=d.value&&8!=d.value&&1!=d.value&&4!=d.value||(g[b][e].error=5),16<d.value&&!d.checked&&(d.error=4),16==d.value&&(b<l-1&&16==g[b+1][e].value&&(d.error=2,g[b+1][e].error=2),e<k-1&&16==g[b][e+1].value&&(d.error=2,g[b][e+1].error=2));for(b=0;b<l;b++)for(e=0;e<k;e++)if(d=g[b][e],d.label!=nil){c=0;
for(var f=e-1;0<=f;f--)16==g[b][f].value&&c++;var h=0;for(f=e+1;f!=k;f++)16==g[b][f].value&&h++;f=0;for(var m=b+1;m!=l;m++)16==g[m][e].value&&f++;var n=0;for(m=b-1;0<=m;m--)16==g[m][e].value&&n++;switch(d.clues){case 8:c!=d.label&&(d.error=3);break;case 2:h!=d.label&&(d.error=3);break;case 4:n!=d.label&&(d.error=3);break;case 1:f!=d.label&&(d.error=3);break;case 32:if(f==d.label&&b!=l-1||n==d.label&&0!=b||c==d.label&&0!=e||h==d.label&&e!=k-1)d.error=3;break;case 16:f+n+c+h!=d.label&&(d.error=3);break;
case 0:f!=d.label&&n!=d.label&&c!=d.label&&h!=d.label&&(d.error=3)}}}catch(r){throw a.exception(r),r;}};a.markPath=function(c,b,e){try{var d=g[c][b];if(d.value!=nil){d.checked=!0;d.error||(d.count=e);var f=0==e?4:e;if(2==d.value||8==d.value||1==d.value||4==d.value)d.error=f;if(0!=(d.value&8))if(0==c)d.error=f;else{var h=g[c-1][b];h.value==nil||0==(h.value&2)?d.error=f:h.checked||a.markPath(c-1,b,e)}0!=(d.value&2)&&(c==l-1?d.error=f:(h=g[c+1][b],h.value==nil||0==(h.value&8)?d.error=f:h.checked||a.markPath(c+
1,b,e)));0!=(d.value&1)&&(0==b?d.error=4:(h=g[c][b-1],h.value==nil||0==(h.value&4)?d.error=f:h.checked||a.markPath(c,b-1,e)));0!=(d.value&4)&&(b==k-1?d.error=f:(h=g[c][b+1],h.value==nil||0==(h.value&1)?d.error=f:h.checked||a.markPath(c,b+1,e)))}}catch(m){throw a.exception(m),m;}};a.solve2=function(){try{for(var c=0;c<l;c++)for(var b=0;b<k;b++){var e=g[c][b];if(e.label!=nil){if(0==e.label)switch(e.clues){case 1:for(var d=c+1;d<l;d++)a.solveCellLine(d,b);break;case 4:for(d=c-1;0<=d;d--)a.solveCellLine(d,
b);break;case 2:for(var f=b+1;f<k;f++)a.solveCellLine(c,f);break;case 8:for(f=b-1;0<=f;f--)a.solveCellLine(c,f)}if(0<e.label)switch(e.clues){case 1:if(2*e.label-1==l-c-1)for(d=c+1;d<l;d+=2)a.solveCellBlack(d,b);break;case 4:if(2*e.label-1==c)for(d=c-1;0<=d;d-=2)a.solveCellBlack(d,b);break;case 2:if(2*e.label-1==k-b-1)for(f=b+1;f<k;f+=2)a.solveCellBlack(c,f);break;case 8:if(2*e.label-1==b)for(f=b-1;0<=f;f-=2)a.solveCellBlack(c,f)}c<l-2&&g[c+1][b].label==nil&&g[c+2][b].label!=nil&&(a.solveCellLine(c+
1,b-1),a.solveCellLine(c+1,b+1));b<k-2&&g[c][b+1].label==nil&&g[c][b+2].label!=nil&&(a.solveCellLine(c-1,b+1),a.solveCellLine(c+1,b+1));c<l-1&&b<k-1&&g[c+1][b+1].label!=nil&&(g[c+1][b].label==nil&&(a.solveCellLine(c+1,b-1),a.solveCellLine(c+2,b)),g[c][b+1].label==nil&&(a.solveCellLine(c-1,b+1),a.solveCellLine(c,b+2)));0<c&&b<k-1&&g[c-1][b+1].label!=nil&&(g[c-1][b].label==nil&&(a.solveCellLine(c-1,b-1),a.solveCellLine(c-2,b)),g[c][b+1].label==nil&&(a.solveCellLine(c+1,b+1),a.solveCellLine(c,b+2)));
g[0][0].label==nil&&g[0][1].label==nil&&g[1][0].label==nil&&(a.solveCellLine(0,1),a.solveCellLine(1,0));g[0][k-1].label==nil&&g[0][k-2].label==nil&&g[1][k-1].label==nil&&(a.solveCellLine(0,k-2),a.solveCellLine(1,k-1));g[l-1][0].label==nil&&g[l-2][0].label==nil&&g[l-1][1].label==nil&&(a.solveCellLine(l-1,1),a.solveCellLine(l-2,0));g[l-1][k-1].label==nil&&g[l-2][k-1].label==nil&&g[l-1][k-2].label==nil&&(a.solveCellLine(l-2,k-1),a.solveCellLine(l-1,k-2));0==b&&(0<c&&g[c-1][b].label==nil&&(a.solveCellLine(c-
2,0),a.solveCellLine(c-1,1)),c<l-1&&g[c+1][b].label==nil&&(a.solveCellLine(c+2,0),a.solveCellLine(c+1,1)));b==k-1&&(0<c&&g[c-1][b].label==nil&&(a.solveCellLine(c-2,k-1),a.solveCellLine(c-1,k-2)),c<l-1&&g[c+1][b].label==nil&&(a.solveCellLine(c+2,k-1),a.solveCellLine(c+1,k-2)));c==l-1&&(0<b&&g[c][b-1].label==nil&&(a.solveCellLine(l-1,b-2),a.solveCellLine(l-2,b-1)),b<k-1&&g[c][b+1].label==nil&&(a.solveCellLine(l-1,b+2),a.solveCellLine(l-2,b+1)));0==c&&(0<b&&g[c][b-1].label==nil&&(a.solveCellLine(0,b-
2),a.solveCellLine(1,b-1)),b<k-1&&g[c][b+1].label==nil&&(a.solveCellLine(0,b+2),a.solveCellLine(1,b+1)))}}}catch(h){throw a.exception(h),h;}};a.solveCellBlack=function(c,b){try{g[c][b].value=16,g[c][b].color=a.current.color,a.solveCellLine(c-1,b),a.solveCellLine(c+1,b),a.solveCellLine(c,b-1),a.solveCellLine(c,b+1)}catch(e){throw a.exception(e),e;}};a.solveCellLine=function(c,b){try{0<=c&&0<=b&&c<l&&b<k&&g[c][b].label==nil&&g[c][b].value==nil&&!g[c][b].fixed&&(g[c][b].value=0,g[c][b].color=a.current.color)}catch(e){throw a.exception(e),
e;}};a.makeMove2=function(c,b,e){try{if(void 0===b||null==b)b=a.current.value==c.value||a.current.value!=nil&&0!=a.current.value&&16!=a.current.value?c.value==nil?0:0==c.value?16:nil:a.current.value;Object.getPrototypeOf(this).makeMove2.call(this,c,b,e)}catch(d){throw a.exception(d),d;}};a.makeMove2Alt=function(c,b,e){try{if(void 0===b||null==b)b=a.current.value==c.value||a.current.value!=nil&&0!=a.current.value&&16!=a.current.value?c.value==nil?16:16==c.value?0:nil:a.current.value;Object.getPrototypeOf(this).makeMove2.call(this,
c,b,e)}catch(d){throw a.exception(d),d;}};a.dragTo2=function(c,b){try{if(!c.fixed&&c.areas!=a.cell.outside){if(c.x==b.x-1&&b.y==c.y){switch(b.value){case nil:case 16:case 0:a.makeMove(b,8);break;case 10:a.makeMove(b,10);break;case 12:a.makeMove(b,12);break;case 9:a.makeMove(b,9);break;case 1:a.makeMove(b,9);break;case 2:a.makeMove(b,10);break;case 4:a.makeMove(b,12);break;case 8:a.makeMove(b,8);break;case 5:q==b.y-1?a.makeMove(b,9):q==b.y+1?a.makeMove(b,12):a.makeMove(b,8);break;case 3:q==b.y-1?a.makeMove(b,
9):p==b.x+1?a.makeMove(b,10):a.makeMove(b,8);break;case 6:q==b.y+1?a.makeMove(b,12):p==b.x+1?a.makeMove(b,10):a.makeMove(b,8)}switch(c.value){case nil:case 16:case 0:a.makeMove(c,2);break;case 5:a.makeMove(c,2);break;case 10:a.makeMove(c,10);break;case 3:a.makeMove(c,3);break;case 6:a.makeMove(c,6);break;case 12:a.makeMove(c,2);break;case 9:a.makeMove(c,2);break;case 1:a.makeMove(c,3);break;case 2:a.makeMove(c,2);break;case 4:a.makeMove(c,6);break;case 8:a.makeMove(c,10)}}if(c.x==b.x+1&&b.y==c.y){switch(b.value){case nil:case 16:case 0:a.makeMove(b,
2);break;case 10:a.makeMove(b,10);break;case 3:a.makeMove(b,3);break;case 6:a.makeMove(b,6);break;case 1:a.makeMove(b,3);break;case 2:a.makeMove(b,2);break;case 4:a.makeMove(b,6);break;case 8:a.makeMove(b,10);break;case 5:q==b.y-1?a.makeMove(b,3):q==b.y+1?a.makeMove(b,6):a.makeMove(b,2);break;case 12:p==b.x-1?a.makeMove(b,10):q==b.y+1?a.makeMove(b,6):a.makeMove(b,2);break;case 9:q==b.y-1?a.makeMove(b,3):p==b.x-1?a.makeMove(b,10):a.makeMove(b,2)}switch(c.value){case nil:case 16:case 0:a.makeMove(c,
8);break;case 5:a.makeMove(c,8);break;case 10:a.makeMove(c,10);break;case 3:a.makeMove(c,8);break;case 6:a.makeMove(c,8);break;case 12:a.makeMove(c,12);break;case 9:a.makeMove(c,9);break;case 1:a.makeMove(c,9);break;case 2:a.makeMove(c,10);break;case 4:a.makeMove(c,12);break;case 8:a.makeMove(c,8)}}if(c.y==b.y+1&&b.x==c.x){switch(b.value){case nil:case 16:case 0:a.makeMove(b,4);break;case 6:a.makeMove(b,6);break;case 12:a.makeMove(b,12);break;case 1:a.makeMove(b,5);break;case 2:a.makeMove(b,6);break;
case 4:a.makeMove(b,4);break;case 8:a.makeMove(b,12);break;case 5:a.makeMove(b,5);break;case 10:p==b.x-1?a.makeMove(b,12):p==b.x+1?a.makeMove(b,6):a.makeMove(b,4);break;case 3:q==b.y-1?a.makeMove(b,5):p==b.x+1?a.makeMove(b,6):a.makeMove(b,4);break;case 9:p==b.x-1?a.makeMove(b,12):q==b.y-1?a.makeMove(b,5):a.makeMove(b,4)}switch(c.value){case nil:case 16:case 0:a.makeMove(c,1);break;case 5:a.makeMove(c,5);break;case 10:a.makeMove(c,1);break;case 3:a.makeMove(c,3);break;case 6:a.makeMove(c,1);break;
case 12:a.makeMove(c,1);break;case 9:a.makeMove(c,9);break;case 1:a.makeMove(c,1);break;case 2:a.makeMove(c,3);break;case 4:a.makeMove(c,5);break;case 8:a.makeMove(c,9)}}if(c.y==b.y-1&&b.x==c.x){switch(b.value){case nil:case 16:case 0:a.makeMove(b,1);break;case 5:a.makeMove(b,5);break;case 3:a.makeMove(b,3);break;case 9:a.makeMove(b,9);break;case 1:a.makeMove(b,1);break;case 2:a.makeMove(b,3);break;case 4:a.makeMove(b,5);break;case 8:a.makeMove(b,9);break;case 10:p==b.x-1?a.makeMove(b,9):p==b.x+1?
a.makeMove(b,3):a.makeMove(b,1);break;case 6:q==b.y+1?a.makeMove(b,5):p==b.x+1?a.makeMove(b,6):a.makeMove(b,4);break;case 12:p==b.x-1?a.makeMove(b,3):q==b.y+1?a.makeMove(b,5):a.makeMove(b,4)}switch(c.value){case nil:case 16:case 0:a.makeMove(c,4);break;case 5:a.makeMove(c,5);break;case 10:a.makeMove(c,4);break;case 3:a.makeMove(c,4);break;case 6:a.makeMove(c,6);break;case 12:a.makeMove(c,12);break;case 9:a.makeMove(c,4);break;case 1:a.makeMove(c,5);break;case 2:a.makeMove(c,6);break;case 4:a.makeMove(c,
4);break;case 8:a.makeMove(c,12)}}p=b.x;q=b.y;a.moveTo(c)}}catch(e){throw a.exception(e),e;}};a.dragTo2Alt=function(c,b){try{b.value!=nil&&a.makeMove(b,nil,a.current.color),c.value!=nil&&a.makeMove(c,nil,a.current.color),a.moveTo(c)}catch(e){throw a.exception(e),e;}};a.valueToString=function(a,b){switch(a){case 16:return"x";case 15:return"nsew";case 0:return"o";case 4:return"s";case 1:return"n";case 2:return"e";case 8:return"w";case 3:return"ne";case 9:return"nw";case 6:return"se";case 12:return"sw";
case 5:return"ns";case 10:return"ew";default:return"-"}};a.paintCell=function(c){try{var b=a.canvas.getContext("2d");b.fillStyle=16==c.value?c.error&&a.display.errors?a.uic.error:a.uic.dark[c.color]:a.uic.light[0];b.fillRect(c.px,c.py,a.unit.x,a.unit.y);if(c.value!=nil){var e=Math.floor((a.unit.x-Math.floor(a.unit.x/4))/2),d=a.unit.x-2*e,f=d+e;b.fillStyle=a.display.errors&&0<c.count?a.uic.dark[c.count%10]:a.display.errors&&4==c.error?a.uic.error:0==c.color?a.uic.line:a.uic.dark[c.color];0==c.value&&
b.fillRect(c.px+e,c.py+e,d,d);0!=(c.value&1)&&b.fillRect(c.px+e,c.py,d,f);0!=(c.value&4)&&b.fillRect(c.px+e,c.py+e,d,f);0!=(c.value&2)&&b.fillRect(c.px+e,c.py+e,f,d);0!=(c.value&8)&&b.fillRect(c.px,c.py+e,f,d)}a.paintSymbolMarkers(c);if(64==c.clues)a.paintCross(c,{color:a.uic.text});else if(c.label!=nil){var g=c.error&&a.display.errors?a.uic.error:a.uic.text,k=parseInt(c.label);32==c.clues?k+="\u00d7":16==c.clues&&(k+="+");a.paintText(k,c,{x:c.px,w:8==c.clues||2==c.clues?5*a.unit.x/6:a.unit.x,y:1==
c.clues||4==c.clues?c.py+a.unit.y/6:c.py,h:a.unit.y,color:g,scale:60});a.paintArrow(c,{arrow:c.clues,shift:!0,fill:g,stroke:g})}c.error&&a.display.errors&&c.value==nil&&c.label==nil&&a.paintErrorDot(c)}catch(n){throw a.exception(n),n;}};a.paintCurrentValue=function(){try{var c=a.uie.value,b=c.getContext("2d");b.fillStyle=a.uic.white;b.fillRect(0,0,c.width,c.height);a.current.value!=nil&&(0==a.current.value?a.paintSquare(b,{x:0,y:0,w:c.width,h:c.height,scale:30,stroke:a.uic.none,fill:a.uic.line}):
16==a.current.value?a.paintSquare(b,{x:0,y:0,w:c.width,h:c.height,scale:90,stroke:a.uic.black,fill:a.uic.black}):a.paintText("#",b,{x:0,y:0,w:c.width,h:c.height,scale:90,stroke:a.uic.black,fill:a.uic.black}))}catch(e){throw a.exception(e),e;}}}Yajilin.prototype=new Puzzle;
