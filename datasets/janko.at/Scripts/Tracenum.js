function Tracenum(){var a=this;a.constructor();a.uis.puzzle=["Trace Numbers"];var e=nil,g=nil,k=1;a.charToValue=a.charToValue.concat([",",nil,"x",nil,"-",nil,"/",nil,".",nil]);a.enable.dragging=!0;a.enable.pgrid=!0;a.enable.values=!1;a.enable.currentValue=!1;a.keypad.left=nil;a.init=function(){Object.getPrototypeOf(a).init.call(a)};a.reset2=function(){try{if(a.level.problem){var b=0;var c=a.level.problem.replace(/\s+/g," ").trim().split(" ");for(var d=0;d<a.size.y;d++)for(var l=0;l<a.size.x;l++){var f=
a.board.c[l][d];var h=c[b++];"."==h||"-"==h?f.label=nil:(f.label=parseInt(h),f.label>k&&(k=f.label))}}if(a.level.solution)for(b=0,c=a.level.solution.replace(/\s+/g," ").trim().split(" "),d=0;d<a.size.y;d++)for(l=0;l<a.size.x;l++)if(f=a.board.c[l][d],h=c[b++],"-"==h||"."==h)f.solution=nil;else{var e=0;h.contains("n")&&(e|=1);h.contains("s")&&(e|=4);if(h.contains("e")||h.contains("o"))e|=2;h.contains("w")&&(e|=8);0!=e&&(f.solution=e)}}catch(r){throw a.exception(r),r;}};var f=!1,m=0,n=null,p=0;a.check2=
function(){try{for(var b=m=0;b<a.size.x;b++)for(var c=0;c<a.size.y;c++){var d=a.board.c[b][c];if(1==d.label&&0==d.count)if(f=!1,m++,p=0,a.checkPath(d,null),f){d.error=1;for(var e=0;e<a.size.x;e++)for(var g=0;g<a.size.y;g++){var h=a.board.c[e][g];h.count==m&&(h.error=1)}}else n.label!=k&&(d.error=n.error=3)}for(b=0;b<a.size.x;b++)for(c=0;c<a.size.y;c++)d=a.board.c[b][c],d.value!=nil&&0==d.count&&(a.board.c[b][c].error=1);for(b=0;b<a.size.x;b++)for(c=0;c<a.size.y;c++)d=a.board.c[b][c],d.value==nil&&
(d.error=2)}catch(q){throw a.exception(q),q;}};a.checkPath=function(b,c){try{b.value==nil?f=!0:(n=b,0!=b.count?f=!0:(b.count=m,b.label!=nil&&(b.label==p+1?p++:f=!0),1!=b.label&&b.label!=k||1==b.value||4==b.value||2==b.value||8==b.value||(f=!0),1!=b.value&&4!=b.value&&2!=b.value&&8!=b.value||1==b.label||b.label==k||(f=!0),c&&(b.x-1==c.x&&0==(b.value&8)&&(f=!0),b.x+1==c.x&&0==(b.value&2)&&(f=!0),b.y-1==c.y&&0==(b.value&1)&&(f=!0),b.y+1==c.y&&0==(b.value&4)&&(f=!0)),f||(0!=(b.value&8)&&(0==b.x?f=!0:
(null==c||c.x!=b.x-1)&&a.checkPath(a.board.c[b.x-1][b.y],b)),0!=(b.value&2)&&(b.x==a.size.x-1?f=!0:(null==c||c.x!=b.x+1)&&a.checkPath(a.board.c[b.x+1][b.y],b)),0!=(b.value&1)&&(0==b.y?f=!0:(null==c||c.y!=b.y-1)&&a.checkPath(a.board.c[b.x][b.y-1],b)),0!=(b.value&4)&&(b.y==a.size.y-1?f=!0:(null==c||c.y!=b.y+1)&&a.checkPath(a.board.c[b.x][b.y+1],b)))))}catch(d){throw a.exception(d),d;}};a.dragTo2=function(b,c){try{if(!b.fixed&&b.areas!=a.cell.outside){if(b.x==c.x-1&&c.y==b.y){switch(c.value){case nil:case 16:case 0:a.makeMove(c,
8);break;case 10:a.makeMove(c,10);break;case 12:a.makeMove(c,12);break;case 9:a.makeMove(c,9);break;case 1:a.makeMove(c,9);break;case 2:a.makeMove(c,10);break;case 4:a.makeMove(c,12);break;case 8:a.makeMove(c,8);break;case 5:g==c.y-1?a.makeMove(c,9):g==c.y+1?a.makeMove(c,12):a.makeMove(c,8);break;case 3:g==c.y-1?a.makeMove(c,9):e==c.x+1?a.makeMove(c,10):a.makeMove(c,8);break;case 6:g==c.y+1?a.makeMove(c,12):e==c.x+1?a.makeMove(c,10):a.makeMove(c,8)}1!=c.label&&c.label!=k||a.makeMove(c,8);switch(b.value){case nil:case 16:case 0:a.makeMove(b,
2);break;case 5:a.makeMove(b,2);break;case 10:a.makeMove(b,10);break;case 3:a.makeMove(b,3);break;case 6:a.makeMove(b,6);break;case 12:a.makeMove(b,2);break;case 9:a.makeMove(b,2);break;case 1:a.makeMove(b,3);break;case 2:a.makeMove(b,2);break;case 4:a.makeMove(b,6);break;case 8:a.makeMove(b,10)}b.label!=nil&&a.makeMove(b,2)}if(b.x==c.x+1&&c.y==b.y){switch(c.value){case nil:case 16:case 0:a.makeMove(c,2);break;case 10:a.makeMove(c,10);break;case 3:a.makeMove(c,3);break;case 6:a.makeMove(c,6);break;
case 1:a.makeMove(c,3);break;case 2:a.makeMove(c,2);break;case 4:a.makeMove(c,6);break;case 8:a.makeMove(c,10);break;case 5:g==c.y-1?a.makeMove(c,3):g==c.y+1?a.makeMove(c,6):a.makeMove(c,2);break;case 12:e==c.x-1?a.makeMove(c,10):g==c.y+1?a.makeMove(c,6):a.makeMove(c,2);break;case 9:g==c.y-1?a.makeMove(c,3):e==c.x-1?a.makeMove(c,10):a.makeMove(c,2)}1!=c.label&&c.label!=k||a.makeMove(c,2);switch(b.value){case nil:case 16:case 0:a.makeMove(b,8);break;case 5:a.makeMove(b,8);break;case 10:a.makeMove(b,
10);break;case 3:a.makeMove(b,8);break;case 6:a.makeMove(b,8);break;case 12:a.makeMove(b,12);break;case 9:a.makeMove(b,9);break;case 1:a.makeMove(b,9);break;case 2:a.makeMove(b,10);break;case 4:a.makeMove(b,12);break;case 8:a.makeMove(b,8)}b.label!=nil&&a.makeMove(b,8)}if(b.y==c.y+1&&c.x==b.x){switch(c.value){case nil:case 16:case 0:a.makeMove(c,4);break;case 6:a.makeMove(c,6);break;case 12:a.makeMove(c,12);break;case 1:a.makeMove(c,5);break;case 2:a.makeMove(c,6);break;case 4:a.makeMove(c,4);break;
case 8:a.makeMove(c,12);break;case 5:a.makeMove(c,5);break;case 10:e==c.x-1?a.makeMove(c,12):e==c.x+1?a.makeMove(c,6):a.makeMove(c,4);break;case 3:g==c.y-1?a.makeMove(c,5):e==c.x+1?a.makeMove(c,6):a.makeMove(c,4);break;case 9:e==c.x-1?a.makeMove(c,12):g==c.y-1?a.makeMove(c,5):a.makeMove(c,4)}1!=c.label&&c.label!=k||a.makeMove(c,4);switch(b.value){case nil:case 16:case 0:a.makeMove(b,1);break;case 5:a.makeMove(b,5);break;case 10:a.makeMove(b,1);break;case 3:a.makeMove(b,3);break;case 6:a.makeMove(b,
1);break;case 12:a.makeMove(b,1);break;case 9:a.makeMove(b,9);break;case 1:a.makeMove(b,1);break;case 2:a.makeMove(b,3);break;case 4:a.makeMove(b,5);break;case 8:a.makeMove(b,9)}b.label!=nil&&a.makeMove(b,1)}if(b.y==c.y-1&&c.x==b.x){switch(c.value){case nil:case 16:case 0:a.makeMove(c,1);break;case 5:a.makeMove(c,5);break;case 3:a.makeMove(c,3);break;case 9:a.makeMove(c,9);break;case 1:a.makeMove(c,1);break;case 2:a.makeMove(c,3);break;case 4:a.makeMove(c,5);break;case 8:a.makeMove(c,9);break;case 10:e==
c.x-1?a.makeMove(c,9):e==c.x+1?a.makeMove(c,3):a.makeMove(c,1);break;case 6:g==c.y+1?a.makeMove(c,5):e==c.x+1?a.makeMove(c,6):a.makeMove(c,4);break;case 12:e==c.x-1?a.makeMove(c,3):g==c.y+1?a.makeMove(c,5):a.makeMove(c,4)}1!=c.label&&c.label!=k||a.makeMove(c,1);switch(b.value){case nil:case 16:case 0:a.makeMove(b,4);break;case 5:a.makeMove(b,5);break;case 10:a.makeMove(b,4);break;case 3:a.makeMove(b,4);break;case 6:a.makeMove(b,6);break;case 12:a.makeMove(b,12);break;case 9:a.makeMove(b,4);break;
case 1:a.makeMove(b,5);break;case 2:a.makeMove(b,6);break;case 4:a.makeMove(b,4);break;case 8:a.makeMove(b,12)}1!=c.label&&c.label!=k||a.makeMove(b,4)}e=c.x;g=c.y;a.moveTo(b)}}catch(d){throw a.exception(d),d;}};a.dragTo2Alt=function(b,c){try{c.value!=nil&&a.makeMove(c,nil,a.current.color),b.value!=nil&&a.makeMove(b,nil,a.current.color),a.moveTo(b)}catch(d){throw a.exception(d),d;}};a.valueToString=function(a,c){switch(a){case 16:return c?"x":"-";case 15:return"nsew";case 0:return"o";case 4:return"s";
case 1:return"n";case 2:return"e";case 8:return"w";case 3:return"ne";case 9:return"nw";case 6:return"se";case 12:return"sw";case 5:return"ns";case 10:return"ew";default:return"-"}};a.paintCell=function(b){try{var c=a.canvas.getContext("2d");c.fillStyle=a.uic.light[0];c.fillRect(b.px,b.py,a.unit.x,a.unit.y);if(b.value!=nil){var d=Math.floor((a.unit.x-Math.floor(a.unit.x/4))/2),e=a.unit.x-2*d,f=e+d;c.fillStyle=0==b.color?a.uic.line:a.uic.light[b.color];0!=(b.value&1)&&c.fillRect(b.px+d,b.py,e,f);0!=
(b.value&4)&&c.fillRect(b.px+d,b.py+d,e,f);0!=(b.value&2)&&c.fillRect(b.px+d,b.py+d,f,e);0!=(b.value&8)&&c.fillRect(b.px,b.py+d,f,e)}b.label!=nil&&(a.paintCircle(b,{fill:a.uic.line,stroke:a.uic.line,scale:75}),a.paintText(b.label.toString(),b));a.paintSymbolMarkers(b);b.error&&a.display.errors&&(b.label!=nil?a.paintErrorCircle(b):a.paintErrorDot(b))}catch(h){throw a.exception(h),h;}}}Tracenum.prototype=new Puzzle;
