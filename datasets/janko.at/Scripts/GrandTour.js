function GrandTour(){var a=this;a.constructor();a.uis.puzzle=["Grand Tour"];var h=a.board.c,l=a.board.h,k=a.board.v,p=1,q=1,m=0,n=0;a.charToValue=a.charToValue.concat(["8",2,"2",3,"4",5,"6",4,"i",2,"m",3,"j",5,"k",4,"a",0,"s",1,"d",nil,"x",0,"c",1,"v",nil,",",0,".",1,"-",nil,"/",nil]);a.cell.values=[0,1,nil];a.line.values=[a.line.wall,a.line.cross,a.line.grid];a.enable.cells=!0;a.enable.lines=!0;a.enable.pnodes=!0;a.enable.dragging=!0;a.enable.pgridlines=!0;a.enable.pedgelines=!1;a.keypad.left=nil;
a.uim.padding=8;a.uic.canvas="#ffffff";a.init=function(){Object.getPrototypeOf(a).init.call(a)};a.reset2=function(){var b;try{p=a.labels.west;q=a.labels.north;m=a.size.x-a.labels.east;n=a.size.y-a.labels.south;if(a.level.problem)for(a.reset2lines(p,q,m,n,a.level.problem),b=0;b<a.board.l.length;b++)a.board.l[b].value!=nil&&(a.board.l[b].fixed=!0);if(a.level.solution){b=0;for(var c=a.level.solution.replace(/\s+/g," ").trim().split(" "),e=q;e<n;e++)for(var g=p;g<m;g++){var d=h[g][e];var f=c[b++];d.solution=
"-"==f||"."==f?0:1}for(g=p;g<m;g++)for(e=q;e<n;e++)d=h[g][e],0==g&&1==d.solution&&(k[0][e].solution=a.line.wall),g==m-1&&1==d.solution&&(k[m][e].solution=a.line.wall),0==e&&1==d.solution&&(l[g][0].solution=a.line.wall),e==n-1&&1==d.solution&&(l[g][n].solution=a.line.wall),g<m-1&&d.solution!=h[g+1][e].solution&&(k[g+1][e].solution=a.line.wall),e<n-1&&d.solution!=h[g][e+1].solution&&(l[g][e+1].solution=a.line.wall)}}catch(r){throw a.exception(r),r;}};a.check2=function(){try{for(var b=0,c=0;c<a.board.l.length;c++){var e=
a.board.l[c];e.value!=a.line.wall||e.checked||a.markPath(e,b++)}if(1!=b)for(a.solved=!1,c=0;c<a.board.l.length;c++)1==a.board.l[c].error&&(a.board.l[c].error=0);for(b=p;b<=m;b++)for(c=q;c<=n;c++)0<b&&l[b-1][c].value==a.line.wall||0<c&&k[b][c-1].value==a.line.wall||b<m&&l[b][c].value==a.line.wall||c<n&&k[b][c].value==a.line.wall||(a.solved=!1,a.board.n[b][c].error=2)}catch(g){throw a.exception(g),g;}};a.markPath=function(b,c){try{var e=b;b.checked=!0;b.count=c;for(var g=0;2>g;g++){var d=b.x,f=b.y;
if(0==g)if(b.type==a.item.hline){var h=4;d+=1}else h=8,f+=1;else h=b.type==a.item.hline?1:2;for(;;)if(1!=h&&d<m&&l[d][f].value==a.line.wall){e=l[d][f];if(e.checked)break;e.checked=!0;e.count=c;h=4;d++}else if(2!=h&&f<n&&k[d][f].value==a.line.wall){e=k[d][f];if(e.checked)break;e.checked=!0;e.count=c;h=8;f++}else if(4!=h&&0<d&&l[d-1][f].value==a.line.wall){e=l[d-1][f];if(e.checked)break;e.checked=!0;e.count=c;h=1;d--}else if(8!=h&&0<f&&k[d][f-1].value==a.line.wall){e=k[d][f-1];if(e.checked)break;e.checked=
!0;e.count=c;h=2;f--}else{0==c&&(e.error=1);break}d==b.x&&f==b.y||0!=c||(e.error=1)}}catch(t){throw a.exception(t),t;}};a.cleanSolution=function(){try{for(var b=!1,c=q;c<n;c++){b=k[0][c].value==a.line.wall;for(var e=p;e<m;e++)h[e][c].value=b?1:0,e<m&&k[e+1][c].value==a.line.wall&&(b=!b)}}catch(g){throw a.exception(g),g;}};a.showSolution2=function(){try{for(var b=0;b<a.board.a.length;b++){var c=a.board.a[b];c.value=c.solution}}catch(e){throw a.exception(e),e;}};a.makeMove2=function(b,c,e){try{var g=
b;c&&(2==c?b=l[b.x][b.y]:3==c?b=l[b.x][b.y+1]:5==c?b=k[b.x][b.y]:4==c&&(b=k[b.x+1][b.y]));if(g!=b){if(b.fixed||!b.valid)return;c=null}Object.getPrototypeOf(this).makeMove2.call(this,b,c,e);g!=b&&(a.current.item=g);if(b.type==a.item.cell&&b.value!=nil){var d=b.x,f=b.y;k[d][f].fixed||(0==d?k[d][f].value=0==h[d][f].value?a.line.grid:a.line.wall:h[d-1][f].value!=nil&&k[d][f].valid&&!k[d][f].fixed&&(h[d-1][f].value==b.value&&(k[d][f].value=a.line.grid),h[d-1][f].value!=b.value&&(k[d][f].value=a.line.wall,
k[d][f].color=b.color)));k[d+1][f].fixed||(d==m-1?k[d+1][f].value=0==h[d][f].value?a.line.grid:a.line.wall:h[d+1][f].value!=nil&&k[d+1][f].valid&&!k[d+1][f].fixed&&(h[d+1][f].value==b.value&&(k[d+1][f].value=a.line.grid),h[d+1][f].value!=b.value&&(k[d+1][f].value=a.line.wall,k[d+1][f].color=b.color)));l[d][f].fixed||(0==f?l[d][f].value=0==h[d][f].value?a.line.grid:a.line.wall:h[d][f-1].value!=nil&&l[d][f].valid&&!l[d][f].fixed&&(h[d][f-1].value==b.value&&(l[d][f].value=a.line.grid),h[d][f-1].value!=
b.value&&(l[d][f].value=a.line.wall,l[d][f].color=b.color)));l[d][f+1].fixed||(f==n-1?l[d][f+1].value=0==h[d][f].value?a.line.grid:a.line.wall:h[d][f+1].value!=nil&&l[d][f+1].valid&&!l[d][f+1].fixed&&(h[d][f+1].value==b.value&&(l[d][f+1].value=a.line.grid),h[d][f+1].value!=b.value&&(l[d][f+1].value=a.line.wall,l[d][f+1].color=b.color)))}}catch(r){throw a.exception(r),r;}};a.valueToString=function(a,c){switch(a){case nil:return"-";case 1:return"x";case 0:return c?"+":"-";default:return"%"}};a.linesToString=
function(){try{for(var b="",c=q;c<=n;c++){b+=" ";for(var e=p;e<m;e++){var g=l[e][c];b=g.value==a.line.wall?b+"\u2013 ":g.value==a.line.cross?b+"x ":b+". "}b+="\n";if(c==n)break;for(e=p;e<=m;e++)g=k[e][c],b=g.value==a.line.wall?b+"| ":g.value==a.line.cross?b+"x ":b+". ";b+="\n"}return b}catch(d){throw a.exception(d),d;}};a.paintHLine=function(b){try{!a.display.errors&&b.fixed&&(a.canvas.getContext("2d").strokeStyle=a.uic.clue),Object.getPrototypeOf(this).paintHLine.call(this,b)}catch(c){throw a.exception(c),
c;}};a.paintVLine=function(b){try{!a.display.errors&&b.fixed&&(a.canvas.getContext("2d").strokeStyle=a.uic.clue),Object.getPrototypeOf(this).paintVLine.call(this,b)}catch(c){throw a.exception(c),c;}};a.paintHCross=function(b){try{!a.display.errors&&b.fixed&&(a.canvas.getContext("2d").strokeStyle=a.uic.clue),Object.getPrototypeOf(this).paintHCross.call(this,b)}catch(c){throw a.exception(c),c;}};a.paintVCross=function(b){try{!a.display.errors&&b.fixed&&(a.canvas.getContext("2d").strokeStyle=a.uic.clue),
Object.getPrototypeOf(this).paintVCross.call(this,b)}catch(c){throw a.exception(c),c;}};a.paintCell=function(b){try{var c=a.canvas.getContext("2d");c.fillStyle=1==b.value?0==b.color?a.uic.gray:a.uic.light[b.color]:a.uic.white;c.fillRect(b.px,b.py,a.unit.x,a.unit.y);a.paintSymbolMarkers(b);0!=b.value||a.solved||a.paintCross(b)}catch(e){throw a.exception(e),e;}};a.paintNode=function(b){try{var c=a.canvas.getContext("2d");b.error&&a.display.errors?(c.fillStyle=a.uic.error,c.fillRect(b.px+.5-a.uim.wall,
b.py+.5-a.uim.wall,2*a.uim.wall,2*a.uim.wall)):(c.fillStyle=a.uic.wall,c.fillRect(b.px+.5-a.uim.wall/2,b.py+.5-a.uim.wall/2,a.uim.wall,a.uim.wall))}catch(e){throw a.exception(e),e;}};a.paintCurrentValue=function(){try{var b=a.uie.value,c=b.getContext("2d");c.fillStyle=a.uic.white;c.fillRect(0,0,b.width,b.height);var e={x:0,y:0,w:b.width,h:b.height,color:a.uic.black,bold:!0,scale:80};a.current.value==a.line.wall?a.paintText("\u2014",c,e):a.current.value==a.line.cross?a.paintText("\u00d7",c,e):a.current.value==
a.line.grid&&a.paintText("\u2022",c,e)}catch(g){throw a.exception(g),g;}}}GrandTour.prototype=new Puzzle;
