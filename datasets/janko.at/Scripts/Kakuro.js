function Kakuro(){var a=this;a.constructor();a.uis.puzzle=["Kakuro"];var r=1,t=1,k=0,m=0;a.variant.kakuro=["kakuro",["Kakuro"]];a.variant.sukrokuro=["sukrokuro",["Sukrokuro"]];a.cell.min=1;a.cell.max=9;a.enable.vmarkers=!0;a.enable.pgrid=!0;a.enable.values=!1;a.enable.currentValue=!1;a.uic.black="#222222";a.keypadValues=a.keypad.numbers.slice(0,9);a.keypadValues[9]=["\u2022",nil];a.cell.values=[1,2,3,4,5,6,7,8,9,nil];a.charToValue=a.charToValue.concat(["0",nil,"/",nil,"-",nil,",",nil]);a.init=function(){Object.getPrototypeOf(a).init.call(a)};
a.reset2=function(){try{a.variant.init(a.variant.kakuro);a.variant.isp(a.variant.kakuro)&&(a.uis.puzzle=a.variant.kakuro[1]);a.variant.isp(a.variant.sukrokuro)&&(a.uis.puzzle=a.variant.sukrokuro[1]);a.size.z==nil&&(a.size.z=9);r=a.labels.west;t=a.labels.north;k=a.size.x-a.labels.east;m=a.size.y-a.labels.south;zmin=1;zmax=a.size.z;if(a.level.problem){var b=0;var e=a.level.problem.replace(/\s+/g," ").trim().split(" ");for(var c=t;c<m;c++)for(var d=r;d<k;d++){var h=a.board.c[d][c];var g=e[b++];"."==
g||"-"==g?h.label=nil:(h.label=parseInt(g),h.fixed=!0)}}if(a.level.solution)for(b=0,e=a.level.solution.replace(/\s+/g," ").trim().split(" "),c=t;c<m;c++)for(d=r;d<k;d++)h=a.board.c[d][c],g=e[b++],h.solution="."==g||"-"==g||"0"==g?nil:parseInt(g);if(a.level.clues)for(e=a.level.clues.replace(/\s+/g," ").trim().split(" "),d=r;d<k;d++)for(c=t;c<m;c++)h=a.board.c[d][c],g=e[c*k+d],h.clues="."==g||"-"==g?none:1==g?1:2==g?2:3==g?3:none;if(!a.level.problem&&a.level.solution){for(c=t;c<m;c++)for(b=0,d=k-1;0<=
d;d--)a.board.c[d][c].solution!=nil?b+=a.board.c[d][c].solution:(a.board.c[d][c].fixed=!0,a.board.c[d][c].label=b,b=0);for(d=r;d<k;d++)for(b=0,c=m-1;0<=c;c--)a.board.c[d][c].solution!=nil?b+=a.board.c[d][c].solution:(a.board.c[d][c].fixed=!0,a.board.c[d][c].label==nil&&(a.board.c[d][c].label=0),a.board.c[d][c].label+=100*b,b=0)}if(a.variant.isp(a.variant.sukrokuro)&&a.level.solution&&!a.level.clues)for(d=r;d<k;d++)for(c=t;c<m;c++){var f=a.board.c[d][c];d<k-1&&1==Math.abs(f.solution-a.board.c[d+1][c].solution)&&
(f.clues+=1);c<m-1&&1==Math.abs(f.solution-a.board.c[d][c+1].solution)&&(f.clues+=2)}}catch(l){throw a.exception(l),l;}};a.check2=function(){var b,e;try{for(var c=r;c<k;c++)for(var d=t;d<m;d++)a.board.c[c][d].value!=nil||a.board.c[c][d].fixed||(a.board.c[c][d].error=3);for(c=r;c<k;++c)for(d=t;d<m;++d)if(0<Math.floor(a.board.c[c][d].label/100)){var h=a.board.c[c][d];var g=[];for(var f=b=e=0;10>f;f++)g[f]=0;for(var l=d+1;l<m;l++){var n=a.board.c[c][l];if(n.fixed)break;++e;n.value==nil?b+=1E3:(g[n.value]++,
b+=n.value)}b!=Math.floor(h.label/100)&&(h.error+=2);for(f=1;10>f;++f)1==g[f]&&(g[f]=0);for(f=1;f<=e;++f)n=a.board.c[c][d+f],n.value!=nil&&0!=g[n.value]&&(n.error=4)}for(c=r;c<k;++c)for(d=t;d<m;++d)if(0<a.board.c[c][d].label%100){h=a.board.c[c][d];g=[];for(f=b=e=0;10>f;f++)g[f]=0;for(l=c+1;l<k;l++){n=a.board.c[l][d];if(n.fixed)break;++e;n.value==nil?b+=1E3:(g[n.value]++,b+=n.value)}b!=h.label%100&&(h.error+=1);for(f=1;10>f;++f)1==g[f]&&(g[f]=0);for(f=1;f<=e;++f)n=a.board.c[c+f][d],n.value!=nil&&0!=
g[n.value]&&(n.error=4)}if(a.variant.isp(a.variant.sukrokuro)){for(c=r;c<k;c++)a.checkLine(c,0,0,1);for(d=t;d<m;d++)a.checkLine(0,d,1,0)}if(a.variant.isp(a.variant.sukrokuro))for(c=r;c<k;++c)for(d=t;d<m;++d){var p=a.board.c[c][d];if(c!=k-1&&p.value!=nil&&a.board.c[c+1][d].value!=nil){var q=a.board.c[c+1][d];if(0!=(p.clues&1))p.value!=q.value+1&&p.value+1!=q.value&&(p.error=q.error=5);else if(p.value==q.value+1||p.value+1==q.value)p.error=q.error=5}if(d!=m-1&&p.value!=nil&&a.board.c[c][d+1].value!=
nil)if(q=a.board.c[c][d+1],0!=(p.clues&2))p.value!=q.value+1&&p.value+1!=q.value&&(p.error=q.error=5);else if(p.value==q.value+1||p.value+1==q.value)p.error=q.error=5}}catch(u){throw a.exception(u),u;}};a.checkLine=function(b,e,c,d){for(var h=[],g=1==c?k:m,f=0;f<g;++f){var l=a.board.c[b+c*f][e+d*f];l.fixed||(l.value==nil?l.error=3:h[l.value]?l.error=h[l.value].error=4:h[l.value]=l)}};a.paintCell=function(b){try{var e=a.canvas.getContext("2d");b.fixed&&(e.fillStyle=a.uic.black,e.fillRect(b.px,b.py,
a.unit.x,a.unit.y),!a.display.errors||2!=b.error&&3!=b.error||(e.fillStyle=a.uic.error,e.beginPath(),e.moveTo(b.px+.5,b.py+.5),e.lineTo(b.px+.5,b.py+a.unit.y+.5),e.lineTo(b.px+a.unit.x+.5,b.py+a.unit.y+.5),e.fill()),!a.display.errors||1!=b.error&&3!=b.error||(e.fillStyle=a.uic.error,e.beginPath(),e.moveTo(b.px+.5,b.py+.5),e.lineTo(b.px+a.unit.x+.5,b.py+.5),e.lineTo(b.px+a.unit.x+.5,b.py+a.unit.y+.5),e.fill()),e.fillStyle=a.uic.light[0],e.strokeStyle=a.uic.light[0],e.font=Math.floor(35*a.unit.x/100).toString()+
"px sans-serif",0<Math.floor(b.label/100)&&(e.textAlign="left",e.textBaseline="alphabetic",e.fillText(Math.floor(b.label/100),b.px+3,b.py+a.unit.y-3)),0<b.label%100&&(e.textAlign="right",e.textBaseline="top",e.fillText(b.label%100,b.px+a.unit.x-3,b.py+3)),0!=b.label&&(e.lineWidth=1,e.beginPath(),e.moveTo(b.px,b.py),e.lineTo(b.px+a.unit.x,b.py+a.unit.y),e.stroke()));b.fixed||(e.fillStyle=a.uic.light[b.color],e.fillRect(b.px,b.py,a.unit.x,a.unit.y),a.paintValueMarkers(b),0!=b.error&&a.display.errors&&
(b.value!=nil?a.paintErrorCircle(b):a.paintErrorDot(b)),b.value!=nil&&a.paintText(b.value.toString(),b));a.paintSymbolMarkers(b)}catch(c){throw a.exception(c),c;}};a.paintDone=function(){try{if(a.variant.isp(a.variant.sukrokuro)){var b=a.canvas.getContext("2d");b.strokeStyle=a.uic.black;b.lineWidth=1;for(var e=a.unit.x/8,c=r;c<k;c++)for(var d=t;d<m;d++){var h=a.board.c[c][d];c!=k-1&&0!=(h.clues&1)&&(b.fillStyle=a.uic.white,b.beginPath(),b.arc(h.px+a.unit.x,h.py+a.unit.y/2,e,0,2*Math.PI),b.fill(),
b.stroke());d!=m-1&&0!=(h.clues&2)&&(b.fillStyle=a.uic.white,b.beginPath(),b.arc(h.px+a.unit.x/2,h.py+a.unit.y,e,0,2*Math.PI),b.fill(),b.stroke())}}}catch(g){throw a.exception(g),g;}}}Kakuro.prototype=new Puzzle;
