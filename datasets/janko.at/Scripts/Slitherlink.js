function Slitherlink(){var a=this;a.constructor();a.uis.puzzle=["Slitherlink","Slitherlink (Rundweg)"];var g=a.board.c,l=a.board.h,k=a.board.v,m=0,n=0;a.variant.puzzle=["puzzle",["Slitherlink"]];a.variant.minimize=["minimize",["Minimize"]];a.variant.maximize=["maximize",["Maximize"]];var p={red:1,green:2,blue:3,fill:4,circle:8,square:16,cross:32,star:64};a.charToValue=a.charToValue.concat(["8",2,"i",2,"2",3,"m",3,"6",4,"k",4,"4",5,"j",5,"a",0,"s",1,"d",nil,"x",0,"c",1,"v",nil,",",0,".",1,"-",nil,
"/",nil]);a.cell.values=[1,0,nil];a.line.values=[a.line.wall,a.line.cross,a.line.grid];a.enable.dragging=!0;a.enable.pnodes=!0;a.enable.pgridlines=!0;a.enable.pedgelines=!1;a.enable.lines=!0;a.enable.cells=!a.config.touch;a.keypad.left=nil;var u=["#000000","#33cc33","#ffaa22","#ee0000","#ee0000"];a.init=function(){Object.getPrototypeOf(a).init.call(a)};a.run2=function(){try{a.config.mode==a.config.modeGame&&(a.level.size=(8).toString()),Object.getPrototypeOf(this).run2.call(this)}catch(b){throw a.exception(b),
b;}};a.setup2=function(){try{if(!a.level.problem&&a.level.moves){a.movesFromString(a.level.moves);for(var b=0;b<a.board.a.length;b++)a.board.a[b].solution=thia.board.a[b].value,a.board.a[b].color=thia.board.a[b].color}!a.level.puzzle&&a.level.variant&&(a.level.puzzle=a.level.variant);a.variant.init(a.variant.puzzle);a.variant.is(a.variant.minimize)&&(a.score.optimize=a.score.minimize);a.variant.is(a.variant.maximize)&&(a.score.optimize=a.score.mazimize);a.variant.is(a.variant.puzzle)||(a.score.label=
a.uis.get("score"),a.isNewSolution=a.isNewSolutionGame)}catch(c){throw a.exception(c),c;}};a.reset2=function(){try{m=a.size.x;n=a.size.y;a.config.touchscreen=!0;a.enable.cells=!0;a.enable.lines=!0;if(a.level.problem){var b=0;var c=a.level.problem.replace(/\s+/g," ").trim().split(" ");for(var e=0;e<n;e++)for(var h=0;h<m;h++){var d=g[h][e];var f=c[b++];var q=f.indexOf("|");if(-1!=q){var r=f.substr(q+1);f=f.substr(0,q);switch(r.charAt(0)){case "c":d.flags|=p.circle;break;case "x":d.flags|=p.cross;break;
case "m":d.flags|=p.square;break;case "s":d.flags|=p.star;break;case "r":d.flags|=p.red;break;case "g":d.flags|=p.green;break;case "b":d.flags|=p.blue;break;case "f":d.flags|=p.fill}r=r.substr(1)}f.contains("o")&&(d.value=1,f=f.replace("o",""));f.contains("x")&&(d.value=0,f=f.replace("x",""));"."==f||"-"==f?d.value=nil:"@"==f?(call.areas=a.cell.outside,d.fixed=!0,d.valid=!1):0!=f.length&&(d.label=parseInt(f))}}if(a.level.solution){b=0;c=a.level.solution.replace(/\s+/g," ").trim().split(" ");for(e=
0;e<n;e++)for(h=0;h<m;h++)d=g[h][e],f=c[b++],d.solution="-"==f||"."==f?-1:1;for(h=0;h<m;h++)for(e=0;e<n;e++)d=g[h][e],0==h&&1==d.solution&&(k[0][e].solution=a.line.wall),h==m-1&&1==d.solution&&(k[m][e].solution=a.line.wall),0==e&&1==d.solution&&(l[h][0].solution=a.line.wall),e==n-1&&1==d.solution&&(l[h][n].solution=a.line.wall),h<m-1&&d.solution!=g[h+1][e].solution&&(k[h+1][e].solution=a.line.wall),e<n-1&&d.solution!=g[h][e+1].solution&&(l[h][e+1].solution=a.line.wall)}}catch(t){throw a.exception(t),
t;}};a.check2=function(){try{for(var b=a.score.current=0;b<m;b++)for(var c=0;c<n;c++)if(g[b][c].label!=nil){var e=0;l[b][c].value==a.line.wall&&e++;l[b][c+1].value==a.line.wall&&e++;k[b][c].value==a.line.wall&&e++;k[b+1][c].value==a.line.wall&&e++;e==g[b][c].label?(a.score.current+=7,g[b][c].count=1):(a.variant.is(a.variant.puzzle)&&(g[b][c].error=2),1==Math.abs(e-g[b][c].label)?g[b][c].count=2:2==Math.abs(e-g[b][c].label)?g[b][c].count=3:3==Math.abs(e-g[b][c].label)&&(g[b][c].count=4))}for(var h=
e=0;h<a.board.l.length;h++){var d=a.board.l[h];d.value!=a.line.wall||d.checked||a.markPath(d,e++)}if(1!=e)for(a.solved=!1,h=0;h<a.board.l.length;h++)1==a.board.l[h].error&&(a.board.l[h].error=0);for(b=0;b<m;b++)for(c=0;c<n+1;c++)l[b][c].checked&&(a.score.current+=3);for(b=0;b<m+1;b++)for(c=0;c<n;c++)k[b][c].checked&&(a.score.current+=3)}catch(f){throw a.exception(f),f;}};a.markPath=function(b,c){try{var e=b;b.checked=!0;b.count=c;for(var h=0;2>h;h++){var d=b.x,f=b.y;if(0==h)if(b.type==a.item.hline){var g=
4;d+=1}else g=8,f+=1;else g=b.type==a.item.hline?1:2;for(;;)if(1!=g&&d<m&&l[d][f].value==a.line.wall){e=l[d][f];if(e.checked)break;e.checked=!0;e.count=c;g=4;d++}else if(2!=g&&f<n&&k[d][f].value==a.line.wall){e=k[d][f];if(e.checked)break;e.checked=!0;e.count=c;g=8;f++}else if(4!=g&&0<d&&l[d-1][f].value==a.line.wall){e=l[d-1][f];if(e.checked)break;e.checked=!0;e.count=c;g=1;d--}else if(8!=g&&0<f&&k[d][f-1].value==a.line.wall){e=k[d][f-1];if(e.checked)break;e.checked=!0;e.count=c;g=2;f--}else{0==c&&
(e.error=1);break}d==b.x&&f==b.y||0!=c||(e.error=1)}}catch(r){throw a.exception(r),r;}};a.cleanSolution=function(){try{for(var b=!1,c=0;c<n;c++){b=k[0][c].value==a.line.wall;for(var e=0;e<m;e++)g[e][c].value=b?1:0,e<m&&k[e+1][c].value==a.line.wall&&(b=!b)}}catch(h){throw a.exception(h),h;}};a.showSolution2=function(){try{for(var b=0;b<a.board.a.length;b++){var c=a.board.a[b];c.value=c.solution}}catch(e){throw a.exception(e),e;}};a.make2=function(){try{m=a.size.x;n=a.size.y;for(var b="",c=0;c<n;c++)for(var e=
0;e<m;e++)b+=a.random.getInt(4)+" ";a.level.problem=b;a.level.author="Otto Janko";a.level.source="Script/Gen";a.level.info=a.level.seed}catch(h){throw a.exception(h),h;}};a.solve2=function(){try{for(var b=0;b<m;b++)for(var c=0;c<n;c++)3==g[b][c].label&&(b<m-1&&3==g[b+1][c].label&&(a.solveVLine(b,c,a.line.wall),a.solveVLine(b+1,c,a.line.wall),a.solveVLine(b+2,c,a.line.wall)),c<n-1&&3==g[b][c+1].label&&(a.solveHLine(b,c,a.line.wall),a.solveHLine(b,c+1,a.line.wall),a.solveHLine(b,c+2,a.line.wall)),b<
m-1&&0==g[b+1][c].label&&(a.solveVLine(b,c,a.line.wall),a.solveHLine(b,c,a.line.wall),a.solveHLine(b,c+1,a.line.wall),a.solveVLine(b+1,c-1,a.line.wall),a.solveVLine(b+1,c+1,a.line.wall)),c<n-1&&0==g[b][c+1].label&&(a.solveHLine(b,c,a.line.wall),a.solveVLine(b,c,a.line.wall),a.solveVLine(b+1,c,a.line.wall),a.solveHLine(b-1,c+1,a.line.wall),a.solveHLine(b+1,c+1,a.line.wall)),0<b&&0==g[b-1][c].label&&(a.solveVLine(b+1,c,a.line.wall),a.solveHLine(b,c,a.line.wall),a.solveHLine(b,c+1,a.line.wall),a.solveVLine(b,
c-1,a.line.wall),a.solveVLine(b,c+1,a.line.wall)),0<c&&0==g[b][c-1].label&&(a.solveHLine(b,c+1,a.line.wall),a.solveVLine(b,c,a.line.wall),a.solveVLine(b+1,c,a.line.wall),a.solveHLine(b-1,c,a.line.wall),a.solveHLine(b+1,c,a.line.wall)),b<m-1&&c<n-1&&3==g[b+1][c+1].label&&(a.solveHLine(b,c,a.line.wall),a.solveVLine(b,c,a.line.wall),a.solveHLine(b+1,c+2,a.line.wall),a.solveVLine(b+2,c+1,a.line.wall)),b<m-1&&0<c&&3==g[b+1][c-1].label&&(a.solveHLine(b,c+1,a.line.wall),a.solveVLine(b,c,a.line.wall),a.solveHLine(b+
1,c-1,a.line.wall),a.solveVLine(b+2,c-1,a.line.wall))),0==g[b][c].label&&(a.solveVLine(b,c,a.line.cross),a.solveVLine(b+1,c,a.line.cross),a.solveHLine(b,c,a.line.cross),a.solveHLine(b,c+1,a.line.cross))}catch(e){throw a.exception(e),e;}};a.solveHLine=function(b,c,e){try{l[b][c].value!=e&&(l[b][c].value=e,l[b][c].color=a.current.color)}catch(h){throw a.exception(h),h;}};a.solveVLine=function(b,c,e){try{k[b][c].value!=e&&(k[b][c].value=e,k[b][c].color=a.current.color)}catch(h){throw a.exception(h),
h;}};a.makeMove2=function(b,c,e){try{var h=b;c&&(2==c?b=l[b.x][b.y]:3==c?b=l[b.x][b.y+1]:5==c?b=k[b.x][b.y]:4==c&&(b=k[b.x+1][b.y]));if(h!=b){if(b.fixed||!b.valid)return;c=null}Object.getPrototypeOf(this).makeMove2.call(this,b,c,e);h!=b&&(a.current.item=h);if(b.type==a.item.cell&&b.value!=nil){var d=b.x,f=b.y;0==d?k[d][f].value=0==g[d][f].value?a.line.grid:a.line.wall:g[d-1][f].value!=nil&&k[d][f].valid&&!k[d][f].fixed&&(g[d-1][f].value==b.value&&(k[d][f].value=a.line.grid),g[d-1][f].value!=b.value&&
(k[d][f].value=a.line.wall,k[d][f].color=b.color));d==m-1?k[d+1][f].value=0==g[d][f].value?a.line.grid:a.line.wall:g[d+1][f].value!=nil&&k[d+1][f].valid&&!k[d+1][f].fixed&&(g[d+1][f].value==b.value&&(k[d+1][f].value=a.line.grid),g[d+1][f].value!=b.value&&(k[d+1][f].value=a.line.wall,k[d+1][f].color=b.color));0==f?l[d][f].value=0==g[d][f].value?a.line.grid:a.line.wall:g[d][f-1].value!=nil&&l[d][f].valid&&!l[d][f].fixed&&(g[d][f-1].value==b.value&&(l[d][f].value=a.line.grid),g[d][f-1].value!=b.value&&
(l[d][f].value=a.line.wall,l[d][f].color=b.color));f==n-1?l[d][f+1].value=0==g[d][f].value?a.line.grid:a.line.wall:g[d][f+1].value!=nil&&l[d][f+1].valid&&!l[d][f+1].fixed&&(g[d][f+1].value==b.value&&(l[d][f+1].value=a.line.grid),g[d][f+1].value!=b.value&&(l[d][f+1].value=a.line.wall,l[d][f+1].color=b.color))}}catch(q){throw a.exception(q),q;}};a.valueToString=function(b){try{return b==nil||b==a.cell.nilalias||0==b?"-":"x"}catch(c){return ojdebug(c.toString()),"%"}};a.onValuesXXX=function(){try{a.config.touchscreen?
a.enable.cells?(a.enable.lines=!0,a.enable.cells=!1):(a.enable.lines=!1,a.enable.cells=!0):Object.getPrototypeOf(this).onValues.call(this)}catch(b){throw a.exception(b),b;}};a.paintInfo=function(b){try{if(!a.variant.is(a.variant.puzzle)){b="";if(a.score.optimize=a.score.maximize)b="MAX";else if(a.score.optimize=a.score.maximize)b="MIN";0!=b.length&&(b=a.uis.get("goal")+": "+b+" \u2022 ");b+=a.score.label+": "+a.score.current+" ("+a.score.best+") ["+a.score.high+"] "}Object.getPrototypeOf(this).paintInfo.call(this,
b)}catch(c){throw a.exception(c),c;}};a.paintCell=function(b){try{var c=a.canvas.getContext("2d");c.fillStyle=1==b.value?0==b.color?a.uic.gray:a.uic.light[b.color]:a.uic.white;c.fillRect(b.px,b.py,a.unit.x,a.unit.y);0!=b.value||a.solved||a.paintCross(b,{color:a.uic.dark[b.color]});if(b.label!=nil){var e=a.variant.is(a.variant.puzzle)?a.uic.dark[b.flags%4]:u[b.count];a.paintText(b.label.toString(),b,{color:e})}a.paintPuzzleMarkers(b);a.paintSymbolMarkers(b);b.error&&a.display.errors&&a.paintErrorCircle(b)}catch(h){throw a.exception(h),
h;}};a.paintPuzzleMarkers=function(b){try{if(0!=b.flags){var c={width:1,color:a.uic.flags,stroke:a.uic.flags,fill:a.uic.none};0!=(b.flags&p.circle)&&a.paintCircle(b,c);0!=(b.flags&p.square)&&a.paintSquare(b,c);0!=(b.flags&p.dot)&&a.paintDot(b,c);0!=(b.flags&p.cross)&&(c.scale=40,c.width=2,a.paintCross(b,c))}}catch(e){throw a.exception(e),e;}};a.paintNode=function(b){try{var c=a.canvas.getContext("2d");c.fillStyle=a.uic.wall;c.fillRect(b.px+.5-a.uim.wall/2,b.py+.5-a.uim.wall/2,a.uim.wall,a.uim.wall)}catch(e){throw a.exception(e),
e;}};a.paintCurrentValue=function(){try{var b=a.uie.value,c=b.getContext("2d");c.fillStyle=a.uic.white;c.fillRect(0,0,b.width,b.height);a.current.type==a.item.cell?(a.uie.value.style.background="#ff8888",1==a.current.value?a.paintSquare(c,{x:0,y:0,w:b.width,h:b.height,fill:a.uic.gray,stroke:a.uic.gray,scale:60}):0==a.current.value&&a.paintCross(c,{x:0,y:0,w:b.width,h:b.height,width:2,color:a.uic.black,scale:60})):a.current.type>=a.item.line&&(a.uie.value.style.background="#8888ff",a.current.value==
a.line.wall?a.paintText("\u2014",c,{x:0,y:0,w:b.width,h:b.height,color:a.uic.black,bold:!0,scale:80}):a.current.value==a.line.cross?a.paintText("\u00d7",c,{x:0,y:0,w:b.width,h:b.height,color:a.uic.black,bold:!0,scale:80}):a.current.value==a.line.grid&&a.paintText("\u2022",c,{x:0,y:0,w:b.width,h:b.height,color:a.uic.black,scale:80}))}catch(e){throw a.exception(e),e;}}}Slitherlink.prototype=new Puzzle;
