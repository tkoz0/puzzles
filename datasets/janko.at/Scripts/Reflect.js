function Reflect(){var b=this;b.constructor();b.uis.puzzle=["Reflect"];var k=b.board.c,m=0,n=0;b.charToValue=b.charToValue.concat([",",nil,"x",nil,"-",nil,"/",nil,".",nil]);b.enable.dragging=!0;b.enable.values=!1;b.enable.currentValue=!1;b.keypad.left=nil;b.uic.clues="#333333";b.init=function(){Object.getPrototypeOf(b).init.call(b)};b.reset2=function(){try{m=b.size.x;n=b.size.y;if(b.level.problem){var a=0;var d=b.level.problem.replace(/\s+/g," ").trim().split(" ");for(var g=0;g<n;g++)for(var c=0;c<
m;c++){var e=k[c][g];var f=d[a++];if("."!=f&&"-"!=f)if("@"==f)e.areas=b.cell.outside,e.value=16,e.valid=!1;else if("#"==f)e.value=16;else if("x"==f||"+"==f)e.value=15;else{var h=0;f.contains("n")&&(h|=1);f.contains("s")&&(h|=4);f.contains("e")&&(h|=2);f.contains("w")&&(h|=8);0!=h&&(e.clues=h);var p=f.match(/\d+/);p&&(e.label=parseInt(p))}e.value!=nil&&(e.fixed=!0)}}if(b.level.solution)for(a=0,d=b.level.solution.replace(/\s+/g," ").trim().split(" "),g=0;g<n;g++)for(c=0;c<m;c++)e=k[c][g],f=d[a++],"-"==
f||"."==f?e.solution=nil:(h=0,f.contains("n")&&(h|=1),f.contains("s")&&(h|=4),f.contains("e")&&(h|=2),f.contains("w")&&(h|=8),0!=h&&(e.solution=h))}catch(q){throw b.exception(q),q;}};b.check2=function(){try{for(var a=function(c,e,g){try{var f=k[c][e];if(f.value!=nil){f.checked=!0;f.count=g;var h=16;15==f.value&&(2==d?h=8:8==d?h=2:1==d?h=4:4==d&&(h=1));if(8==h||16==h&&0!=(f.value&8))if(0==c)f.error=1;else if(15!=f.value||2==d){d=2;var l=k[c-1][e];l.value==nil||0==(l.value&2)?f.error=1:l.checked&&15!=
l.value||a(c-1,e,g)}if(2==h||16==h&&0!=(f.value&2))if(c==m-1)f.error=1;else if(15!=f.value||8==d)d=8,l=k[c+1][e],l.value==nil||0==(l.value&8)?f.error=1:l.checked&&15!=l.value||a(c+1,e,g);if(1==h||16==h&&0!=(f.value&1))if(0==e)f.error=1;else if(15!=f.value||4==d)d=4,l=k[c][e-1],l.value==nil||0==(l.value&4)?f.error=1:l.checked&&15!=l.value||a(c,e-1,g);if(4==h||16==h&&0!=(f.value&4))if(e==n-1)f.error=1;else if(15!=f.value||1==d)d=1,l=k[c][e+1],l.value==nil||0==(l.value&1)?f.error=1:l.checked&&15!=l.value||
a(c,e+1,g)}}catch(r){throw b.exception(r),r;}},d=16,g=0,c=0;c<m;c++)for(var e=0;e<n;e++){var f=k[c][e];f.checked||f.value==nil||a(c,e,g++)}1!=g&&(b.solved=!1);for(c=0;c<m;c++)for(e=0;e<n;e++)if(f=k[c][e],15==f.value){if(f.fixed||(f.error=3),0==c||c==m-1||0==e||e==n-1||0==(k[c-1][e].value&2)||0==(k[c+1][e].value&8)||0==(k[c][e-1].value&4)||0==(k[c][e+1].value&1))f.error=1}else f.value!=nil&&5!=f.value&&10!=f.value&&3!=f.value&&6!=f.value&&9!=f.value&&12!=f.value&&(f.error=1);for(c=0;c<m;c++)for(e=
0;e<n;e++)f=k[c][e],0!=f.clues&&f.value==nil&&(f.error=1);for(c=0;c<m;c++)for(e=0;e<n;e++)15!=k[c][e].value||k[c-1][e].value!=nil&&0!=(k[c-1][e].value&2)&&k[c+1][e].value!=nil&&0!=(k[c+1][e].value&8)&&k[c][e-1].value!=nil&&0!=(k[c][e-1].value&4)&&k[c][e+1].value!=nil&&0!=(k[c][e+1].value&1)||(k[c][e].error=1);for(c=0;c<m;c++)for(e=0;e<n;e++)if(k[c][e].label!=nil){f=k[c][e];g=0;var h=null;for(h=f;h.value!=nil&&0!=(h.value&1);h=k[h.x][h.y-1])g++;for(h=f;h.value!=nil&&0!=(h.value&4);h=k[h.x][h.y+1])g++;
for(h=f;h.value!=nil&&0!=(h.value&8);h=k[h.x-1][h.y])g++;for(h=f;h.value!=nil&&0!=(h.value&2);h=k[h.x+1][h.y])g++;g!=f.label-1&&(f.error=2)}}catch(p){throw b.exception(p),p;}};b.solve2=function(){try{for(var a=0;a<m;a++)for(var d=0;d<n;d++){var g=k[a][d];if(g.fixed){if(0!=(g.value&1)){var c=k[g.x][g.y-1];c.value=c.value==nil?4:c.value|4}0!=(g.value&4)&&(c=k[g.x][g.y+1],c.value=c.value==nil?1:c.value|1);0!=(g.value&8)&&(c=k[g.x-1][g.y],c.value=c.value==nil?2:c.value|2);0!=(g.value&2)&&(c=k[g.x+1][g.y],
c.value=c.value==nil?8:c.value|8)}}for(a=0;a<m;a++)for(d=0;d<n;d++)if(0!=k[a][d].clues){var e=k[a][d];c=null;0!=(e.clues&1)&&(e.value=e.value==nil?4:e.value|=4,c=k[a][d+1],c.value=c.value==nil?1:c.value|=1);0!=(e.clues&4)&&(e.value=e.value==nil?1:e.value|=1,c=k[a][d-1],c.value=c.value==nil?4:c.value|=4);0!=(e.clues&8)&&(e.value=e.value==nil?2:e.value|=2,c=k[a+1][d],c.value=c.value==nil?8:c.value|=8);0!=(e.clues&2)&&(e.value=e.value==nil?8:e.value|=8,c=k[a-1][d],c.value=c.value==nil?2:c.value|=2)}}catch(f){throw b.exception(f),
f;}};b.makeMove2=function(a,d,g){try{d||(d=nil),Object.getPrototypeOf(this).makeMove2.call(this,a,d,g)}catch(c){throw b.exception(c),c;}};b.dragTo2=function(a,d){try{var g=d.value==nil?0:d.value,c=a.value==nil?0:a.value;d.y==a.y?d.x>a.x?(g|=8,c|=2):(g|=2,c|=8):d.x==a.x&&(d.y>a.y?(g|=1,c|=4):(g|=4,c|=1));g&&!d.fixed&&b.makeMove(d,g);c&&!a.fixed&&b.makeMove(a,c);b.moveTo(a);b.current.value=0}catch(e){throw b.exception(e),e;}};b.dragTo2Alt=function(a,d){try{d.value!=nil&&b.makeMove(d,nil,b.current.color),
a.value!=nil&&b.makeMove(a,nil,b.current.color),b.moveTo(a)}catch(g){throw b.exception(g),g;}};b.valueToString=function(a,b){switch(a){case 16:return b?"x":"-";case 15:return"nsew";case 0:return"o";case 4:return"s";case 1:return"n";case 2:return"e";case 8:return"w";case 3:return"ne";case 9:return"nw";case 6:return"se";case 12:return"sw";case 5:return"ns";case 10:return"ew";default:return"-"}};b.paintCell=function(a){try{var d=b.canvas.getContext("2d");d.fillStyle=b.uic.light[0];d.fillRect(a.px,a.py,
b.unit.x,b.unit.y);if(a.value!=nil){var g=Math.floor((b.unit.x-Math.floor(b.unit.x/4))/2),c=b.unit.x-2*g,e=c+g;d.fillStyle=b.display.errors?b.uic.dark[a.count%10]:b.display.errors&&1==a.error?b.uic.error:a.fixed?b.uic.clues:0==a.color?b.uic.line:b.uic.dark[a.color];16!=a.value||b.solved||b.paintCross(a);0==a.value&&d.fillRect(a.px+g,a.py+g,c,c);0!=(a.value&1)&&d.fillRect(a.px+g,a.py,c,e);0!=(a.value&4)&&d.fillRect(a.px+g,a.py+g,c,e);0!=(a.value&2)&&d.fillRect(a.px+g,a.py+g,e,c);0!=(a.value&8)&&d.fillRect(a.px,
a.py+g,e,c)}0!=a.clues&&(d.fillStyle=b.display.errors&&a.error?d.strokeStyle=b.uic.error:d.strokeStyle=b.uic.black,9==a.clues?(d.beginPath(),d.moveTo(a.px,a.py),d.lineTo(a.px+b.unit.x,a.py),d.lineTo(a.px,a.py+b.unit.y),d.lineTo(a.px,a.py),d.fill(),d.stroke(),a.label!=nil&&b.paintText(a.label.toString(),d,{x:a.px+2,y:a.py+2,w:b.unit.x/2,h:b.unit.y/2,scale:100,color:b.uic.white})):3==a.clues?(d.beginPath(),d.moveTo(a.px,a.py),d.lineTo(a.px+b.unit.x,a.py),d.lineTo(a.px+b.unit.x,a.py+b.unit.y),d.lineTo(a.px,
a.py),d.fill(),d.stroke(),a.label!=nil&&b.paintText(a.label.toString(),d,{x:a.px+b.unit.x/2-2,y:a.py+2,w:b.unit.x/2,h:b.unit.y/2,scale:100,color:b.uic.white})):12==a.clues?(d.beginPath(),d.moveTo(a.px,a.py),d.lineTo(a.px+b.unit.x,a.py+b.unit.y),d.lineTo(a.px,a.py+b.unit.y),d.moveTo(a.px,a.py),d.fill(),d.stroke(),a.label!=nil&&b.paintText(a.label.toString(),d,{x:a.px+2,y:a.py+b.unit.y/2,w:b.unit.x/2,h:b.unit.y/2,scale:100,color:b.uic.white})):6==a.clues&&(d.beginPath(),d.moveTo(a.px+b.unit.x,a.py),
d.lineTo(a.px+b.unit.x,a.py+b.unit.y),d.lineTo(a.px,a.py+b.unit.y),d.moveTo(a.px+b.unit.x,a.py),d.fill(),d.stroke(),a.label!=nil&&b.paintText(a.label.toString(),d,{x:a.px+b.unit.x/2,y:a.py+b.unit.y/2,w:b.unit.x/2,h:b.unit.y/2,scale:100,color:b.uic.white})));b.paintSymbolMarkers(a)}catch(f){throw b.exception(f),f;}};b.paintCurrentValue=function(){try{var a=b.uie.value,d=a.getContext("2d");d.fillStyle=b.uic.white;d.fillRect(0,0,a.width,a.height);b.current.value!=nil&&(0==b.current.value?b.paintSquare(d,
{x:0,y:0,w:a.width,h:a.height,scale:30,stroke:b.uic.none,fill:b.uic.line}):16==b.current.value?b.paintCross(d,{x:0,y:0,w:a.width,h:a.height,stroke:b.uic.cross,fill:b.uic.cross}):b.paintText("#",d,{x:0,y:0,w:a.width,h:a.height,scale:90,stroke:b.uic.black,fill:b.uic.black}))}catch(g){throw b.exception(g),g;}}}Reflect.prototype=new Puzzle;
